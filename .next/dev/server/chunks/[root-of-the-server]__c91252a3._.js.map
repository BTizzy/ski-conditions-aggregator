{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/ryanbartell/ski-conditions-aggregator/lib/resorts.ts"],"sourcesContent":["export interface Resort {\n  id: string;\n  name: string;\n  state: string;\n  lat: number;\n  lon: number;\n  openWeatherId?: string; // For OpenWeather API\n  scrapeUrl: string; // Homepage for scraping conditions\n  logoUrl?: string;\n}\n\nexport const resorts: Resort[] = [\n  // --- Top Priority Resorts ---\n  {\n    id: 'loon-mountain',\n    name: 'Loon Mountain',\n    state: 'NH',\n    lat: 44.0367,\n    lon: -71.6217,\n    scrapeUrl: 'https://www.loonmtn.com/mountain-info/conditions',\n  },\n  {\n    id: 'sunday-river',\n    name: 'Sunday River',\n    state: 'ME',\n    lat: 44.4722,\n    lon: -70.8567,\n    scrapeUrl: 'https://www.sundayriver.com/mountain-info/conditions',\n  },\n  {\n    id: 'sugarloaf',\n    name: 'Sugarloaf',\n    state: 'ME',\n    lat: 45.0311,\n    lon: -70.3133,\n    scrapeUrl: 'https://www.sugarloaf.com/conditions',\n  },\n  // --- Major Vermont Resorts ---\n  {\n    id: 'stowe',\n    name: 'Stowe',\n    state: 'VT',\n    lat: 44.4654,\n    lon: -72.6874,\n    scrapeUrl: 'https://www.stowe.com/the-mountain/mountain-conditions/',\n  },\n  {\n    id: 'killington',\n    name: 'Killington',\n    state: 'VT',\n    lat: 43.6045,\n    lon: -72.8201,\n    scrapeUrl: 'https://www.killington.com/the-mountain/mountain-conditions',\n  },\n  {\n    id: 'sugarbush',\n    name: 'Sugarbush',\n    state: 'VT',\n    lat: 44.1436,\n    lon: -72.8944,\n    scrapeUrl: 'https://www.sugarbush.com/mountain-info/conditions/',\n  },\n  {\n    id: 'okemo',\n    name: 'Okemo',\n    state: 'VT',\n    lat: 43.4036,\n    lon: -72.7202,\n    scrapeUrl: 'https://www.okemo.com/the-mountain/mountain-conditions/',\n  },\n  {\n    id: 'mount-snow',\n    name: 'Mount Snow',\n    state: 'VT',\n    lat: 42.9606,\n    lon: -72.9205,\n    scrapeUrl: 'https://www.mountsnow.com/the-mountain/mountain-conditions/',\n  },\n  {\n    id: 'stratton',\n    name: 'Stratton',\n    state: 'VT',\n    lat: 43.1135,\n    lon: -72.9205,\n    scrapeUrl: 'https://www.stratton.com/the-mountain/mountain-conditions',\n  },\n  {\n    id: 'jay-peak',\n    name: 'Jay Peak',\n    state: 'VT',\n    lat: 44.9242,\n    lon: -72.5316,\n    scrapeUrl: 'https://jaypeakresort.com/ski-ride/conditions',\n  },\n  {\n    id: 'smugglers-notch',\n    name: \"Smugglers' Notch\",\n    state: 'VT',\n    lat: 44.5884,\n    lon: -72.7815,\n    scrapeUrl: 'https://www.smuggs.com/pages/winter/skiride/conditions.php',\n  },\n  {\n    id: 'bromley',\n    name: 'Bromley',\n    state: 'VT',\n    lat: 43.2137,\n    lon: -72.9362,\n    scrapeUrl: 'https://www.bromley.com/the-mountain/conditions/',\n  },\n  {\n    id: 'mad-river-glen',\n    name: 'Mad River Glen',\n    state: 'VT',\n    lat: 44.2019,\n    lon: -72.9172,\n    scrapeUrl: 'https://www.madriverglen.com/mountain-info/conditions',\n  },\n  // --- Major New Hampshire Resorts ---\n  {\n    id: 'bretton-woods',\n    name: 'Bretton Woods',\n    state: 'NH',\n    lat: 44.2547,\n    lon: -71.4417,\n    scrapeUrl: 'https://www.brettonwoods.com/mountain-info/conditions',\n  },\n  {\n    id: 'cannon-mountain',\n    name: 'Cannon Mountain',\n    state: 'NH',\n    lat: 44.1786,\n    lon: -71.6981,\n    scrapeUrl: 'https://www.cannonmt.com/mountain-info/conditions',\n  },\n  {\n    id: 'waterville-valley',\n    name: 'Waterville Valley',\n    state: 'NH',\n    lat: 43.9506,\n    lon: -71.5072,\n    scrapeUrl: 'https://www.waterville.com/mountain-report',\n  },\n  {\n    id: 'wildcat',\n    name: 'Wildcat',\n    state: 'NH',\n    lat: 44.2581,\n    lon: -71.2256,\n    scrapeUrl: 'https://www.skiwildcat.com/the-mountain/mountain-conditions',\n  },\n  {\n    id: 'attitash',\n    name: 'Attitash',\n    state: 'NH',\n    lat: 44.0822,\n    lon: -71.2292,\n    scrapeUrl: 'https://www.attitash.com/the-mountain/mountain-conditions',\n  },\n  {\n    id: 'cranmore',\n    name: 'Cranmore',\n    state: 'NH',\n    lat: 44.0584,\n    lon: -71.1284,\n    scrapeUrl: 'https://www.cranmore.com/conditions',\n  },\n  // --- Additional Maine Resorts ---\n  {\n    id: 'saddleback',\n    name: 'Saddleback',\n    state: 'ME',\n    lat: 44.9531,\n    lon: -70.5272,\n    scrapeUrl: 'https://www.saddlebackmaine.com/conditions/',\n  },\n  {\n    id: 'squaw-mountain',\n    name: 'Squaw Mountain',\n    state: 'ME',\n    lat: 44.0822,\n    lon: -70.7567,\n    scrapeUrl: 'https://www.squawmt.com/conditions/',\n  },\n  // --- Massachusetts Resorts ---\n  {\n    id: 'jiminy-peak',\n    name: 'Jiminy Peak',\n    state: 'MA',\n    lat: 42.5556,\n    lon: -73.2922,\n    scrapeUrl: 'https://www.jiminypeak.com/mountain/conditions',\n  },\n  {\n    id: 'wachusett',\n    name: 'Wachusett',\n    state: 'MA',\n    lat: 42.5031,\n    lon: -71.8867,\n    scrapeUrl: 'https://www.wachusett.com/The-Mountain/Conditions.aspx',\n  },\n  // --- New York Resorts ---\n  {\n    id: 'whiteface',\n    name: 'Whiteface',\n    state: 'NY',\n    lat: 44.3656,\n    lon: -73.9022,\n    scrapeUrl: 'https://whiteface.com/conditions',\n  },\n  {\n    id: 'gore-mountain',\n    name: 'Gore Mountain',\n    state: 'NY',\n    lat: 43.6747,\n    lon: -74.0061,\n    scrapeUrl: 'https://goremountain.com/conditions/',\n  },\n  {\n    id: 'hunter-mountain',\n    name: 'Hunter Mountain',\n    state: 'NY',\n    lat: 42.2022,\n    lon: -74.2331,\n    scrapeUrl: 'https://www.huntermtn.com/the-mountain/mountain-conditions',\n  },\n  {\n    id: 'windham-mountain',\n    name: 'Windham Mountain',\n    state: 'NY',\n    lat: 42.2917,\n    lon: -74.2581,\n    scrapeUrl: 'https://www.windhammountain.com/the-mountain/mountain-conditions',\n  },\n  {\n    id: 'belleayre',\n    name: 'Belleayre',\n    state: 'NY',\n    lat: 42.1356,\n    lon: -74.5061,\n    scrapeUrl: 'https://www.belleayre.com/conditions/',\n  },\n  // --- Pennsylvania Resorts ---\n  {\n    id: 'jack-frost-big-boulder',\n    name: 'Jack Frost Big Boulder',\n    state: 'PA',\n    lat: 41.1081,\n    lon: -75.6581,\n    scrapeUrl: 'https://www.jfbb.com/conditions/',\n  },\n  {\n    id: 'elk-mountain',\n    name: 'Elk Mountain',\n    state: 'PA',\n    lat: 41.7131,\n    lon: -75.5781,\n    scrapeUrl: 'https://www.elkskier.com/conditions/',\n  },\n  {\n    id: 'blue-mountain',\n    name: 'Blue Mountain',\n    state: 'PA',\n    lat: 40.8117,\n    lon: -75.5217,\n    scrapeUrl: 'https://www.skibluemt.com/mountain-report/',\n  },\n  {\n    id: 'seven-springs',\n    name: 'Seven Springs',\n    state: 'PA',\n    lat: 40.0231,\n    lon: -79.2981,\n    scrapeUrl: 'https://www.7springs.com/conditions/',\n  },\n  // --- Connecticut Resorts ---\n  {\n    id: 'mount-southington',\n    name: 'Mount Southington',\n    state: 'CT',\n    lat: 41.5992,\n    lon: -72.9272,\n    scrapeUrl: 'https://mountsouthington.com/conditions/',\n  },\n  {\n    id: 'powder-ridge',\n    name: 'Powder Ridge',\n    state: 'CT',\n    lat: 41.4992,\n    lon: -72.8272,\n    scrapeUrl: 'https://www.powderridgepark.com/conditions/',\n  },\n  // --- New Jersey Resorts ---\n  {\n    id: 'mountain-creek',\n    name: 'Mountain Creek',\n    state: 'NJ',\n    lat: 41.1822,\n    lon: -74.5081,\n    scrapeUrl: 'https://www.mountaincreek.com/mountain/conditions/',\n  },\n  {\n    id: 'campgaw-mountain',\n    name: 'Campgaw Mountain',\n    state: 'NJ',\n    lat: 41.0481,\n    lon: -74.2081,\n    scrapeUrl: 'https://www.campgaw.com/conditions/',\n  },\n  // --- Additional New Hampshire Resorts ---\n  {\n    id: 'black-mountain',\n    name: 'Black Mountain',\n    state: 'NH',\n    lat: 44.1667,\n    lon: -71.1667,\n    scrapeUrl: 'https://www.blackmt.com/conditions/',\n  },\n];"],"names":[],"mappings":"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"}},
    {"offset": {"line": 362, "column": 0}, "map": {"version":3,"sources":["file:///Users/ryanbartell/ski-conditions-aggregator/lib/nws.ts"],"sourcesContent":["\nexport interface NWSObservation {\n  temperature: number | null; // Celsius\n  windSpeed: number | null; // km/h\n  windDirection: number | null; // degrees\n  textDescription: string;\n  icon: string;\n  timestamp: string;\n  raw: any;\n}\n\n// Get NWS gridpoint for a given lat/lon\nexport async function getNWSGridpoint(lat: number, lon: number): Promise<{office: string, gridX: number, gridY: number}> {\n  const url = `https://api.weather.gov/points/${lat},${lon}`;\n  const res = await fetch(url, { headers: { 'User-Agent': 'ski-conditions-aggregator' } });\n  if (!res.ok) throw new Error('Failed to get NWS gridpoint');\n  const data = await res.json();\n  return {\n    office: data.properties.gridId,\n    gridX: data.properties.gridX,\n    gridY: data.properties.gridY,\n  };\n}\n\n// Get current observation for a gridpoint\nexport async function getNWSObservation(lat: number, lon: number): Promise<NWSObservation> {\n  const grid = await getNWSGridpoint(lat, lon);\n  const url = `https://api.weather.gov/gridpoints/${grid.office}/${grid.gridX},${grid.gridY}/forecast`;\n  const res = await fetch(url, { headers: { 'User-Agent': 'ski-conditions-aggregator' } });\n  if (!res.ok) throw new Error('Failed to get NWS forecast');\n  const data = await res.json();\n  const period = data.properties.periods[0];\n  return {\n    temperature: period.temperature,\n    windSpeed: period.windSpeed ? parseInt(period.windSpeed) : null,\n    windDirection: period.windDirection || null,\n    textDescription: period.shortForecast,\n    icon: period.icon,\n    timestamp: period.startTime,\n    raw: period,\n  };\n}\n"],"names":[],"mappings":";;;;;;AAYO,eAAe,gBAAgB,GAAW,EAAE,GAAW;IAC5D,MAAM,MAAM,CAAC,+BAA+B,EAAE,IAAI,CAAC,EAAE,KAAK;IAC1D,MAAM,MAAM,MAAM,MAAM,KAAK;QAAE,SAAS;YAAE,cAAc;QAA4B;IAAE;IACtF,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM;IAC7B,MAAM,OAAO,MAAM,IAAI,IAAI;IAC3B,OAAO;QACL,QAAQ,KAAK,UAAU,CAAC,MAAM;QAC9B,OAAO,KAAK,UAAU,CAAC,KAAK;QAC5B,OAAO,KAAK,UAAU,CAAC,KAAK;IAC9B;AACF;AAGO,eAAe,kBAAkB,GAAW,EAAE,GAAW;IAC9D,MAAM,OAAO,MAAM,gBAAgB,KAAK;IACxC,MAAM,MAAM,CAAC,mCAAmC,EAAE,KAAK,MAAM,CAAC,CAAC,EAAE,KAAK,KAAK,CAAC,CAAC,EAAE,KAAK,KAAK,CAAC,SAAS,CAAC;IACpG,MAAM,MAAM,MAAM,MAAM,KAAK;QAAE,SAAS;YAAE,cAAc;QAA4B;IAAE;IACtF,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM;IAC7B,MAAM,OAAO,MAAM,IAAI,IAAI;IAC3B,MAAM,SAAS,KAAK,UAAU,CAAC,OAAO,CAAC,EAAE;IACzC,OAAO;QACL,aAAa,OAAO,WAAW;QAC/B,WAAW,OAAO,SAAS,GAAG,SAAS,OAAO,SAAS,IAAI;QAC3D,eAAe,OAAO,aAAa,IAAI;QACvC,iBAAiB,OAAO,aAAa;QACrC,MAAM,OAAO,IAAI;QACjB,WAAW,OAAO,SAAS;QAC3B,KAAK;IACP;AACF"}},
    {"offset": {"line": 408, "column": 0}, "map": {"version":3,"sources":["file:///Users/ryanbartell/ski-conditions-aggregator/lib/weather.ts"],"sourcesContent":["import { OpenWeatherResponse, ParsedWeather } from './types';\n\nconst OPENWEATHER_API_KEY = process.env.OPENWEATHER_API_KEY;\nconst BASE_URL = 'https://api.openweathermap.org/data/2.5/weather';\n\nasync function delay(ms: number): Promise<void> {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nasync function fetchWithRetry(url: string, retries: number = 3, backoff: number = 1000): Promise<Response> {\n  for (let i = 0; i < retries; i++) {\n    try {\n      const response = await fetch(url);\n      if (response.ok) return response;\n      if (response.status === 429) { // Rate limit\n        await delay(backoff * Math.pow(2, i));\n        continue;\n      }\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n    } catch (error) {\n      if (i === retries - 1) throw error;\n      await delay(backoff * Math.pow(2, i));\n    }\n  }\n  throw new Error('Max retries exceeded');\n}\n\nexport async function fetchCurrentWeather(lat: number, lon: number): Promise<ParsedWeather> {\n  if (!OPENWEATHER_API_KEY) {\n    throw new Error('OpenWeather API key not configured');\n  }\n\n  const url = `${BASE_URL}?lat=${lat}&lon=${lon}&appid=${OPENWEATHER_API_KEY}&units=imperial`;\n\n  try {\n    const response = await fetchWithRetry(url);\n    const contentType = response.headers.get('content-type');\n\n    if (!contentType || !contentType.includes('application/json')) {\n      throw new Error(`Invalid response type: ${contentType}`);\n    }\n\n    const data: OpenWeatherResponse = await response.json();\n\n    // Check if the response contains an error\n    if (data.cod && data.cod !== 200) {\n      throw new Error(`OpenWeather API error: ${data.cod}`);\n    }\n\n    // Parse the data\n    const temp = data.main.temp;\n    const snowDepth = data.snow?.['1h'] ? data.snow['1h'] * 39.37 : 0; // Convert mm to inches\n    const windSpeed = data.wind.speed;\n    const visibility = data.visibility || 16093; // Default to 10 miles in meters\n\n    return {\n      temp,\n      snowDepth,\n      windSpeed,\n      visibility,\n    };\n  } catch (error) {\n    console.error('Error fetching weather:', error);\n    throw new Error(`Failed to fetch weather data: ${(error as Error).message}`);\n  }\n}"],"names":[],"mappings":";;;;AAEA,MAAM,sBAAsB,QAAQ,GAAG,CAAC,mBAAmB;AAC3D,MAAM,WAAW;AAEjB,eAAe,MAAM,EAAU;IAC7B,OAAO,IAAI,QAAQ,CAAA,UAAW,WAAW,SAAS;AACpD;AAEA,eAAe,eAAe,GAAW,EAAE,UAAkB,CAAC,EAAE,UAAkB,IAAI;IACpF,IAAK,IAAI,IAAI,GAAG,IAAI,SAAS,IAAK;QAChC,IAAI;YACF,MAAM,WAAW,MAAM,MAAM;YAC7B,IAAI,SAAS,EAAE,EAAE,OAAO;YACxB,IAAI,SAAS,MAAM,KAAK,KAAK;gBAC3B,MAAM,MAAM,UAAU,KAAK,GAAG,CAAC,GAAG;gBAClC;YACF;YACA,MAAM,IAAI,MAAM,CAAC,KAAK,EAAE,SAAS,MAAM,CAAC,EAAE,EAAE,SAAS,UAAU,EAAE;QACnE,EAAE,OAAO,OAAO;YACd,IAAI,MAAM,UAAU,GAAG,MAAM;YAC7B,MAAM,MAAM,UAAU,KAAK,GAAG,CAAC,GAAG;QACpC;IACF;IACA,MAAM,IAAI,MAAM;AAClB;AAEO,eAAe,oBAAoB,GAAW,EAAE,GAAW;IAChE,IAAI,CAAC,qBAAqB;QACxB,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,MAAM,GAAG,SAAS,KAAK,EAAE,IAAI,KAAK,EAAE,IAAI,OAAO,EAAE,oBAAoB,eAAe,CAAC;IAE3F,IAAI;QACF,MAAM,WAAW,MAAM,eAAe;QACtC,MAAM,cAAc,SAAS,OAAO,CAAC,GAAG,CAAC;QAEzC,IAAI,CAAC,eAAe,CAAC,YAAY,QAAQ,CAAC,qBAAqB;YAC7D,MAAM,IAAI,MAAM,CAAC,uBAAuB,EAAE,aAAa;QACzD;QAEA,MAAM,OAA4B,MAAM,SAAS,IAAI;QAErD,0CAA0C;QAC1C,IAAI,KAAK,GAAG,IAAI,KAAK,GAAG,KAAK,KAAK;YAChC,MAAM,IAAI,MAAM,CAAC,uBAAuB,EAAE,KAAK,GAAG,EAAE;QACtD;QAEA,iBAAiB;QACjB,MAAM,OAAO,KAAK,IAAI,CAAC,IAAI;QAC3B,MAAM,YAAY,KAAK,IAAI,EAAE,CAAC,KAAK,GAAG,KAAK,IAAI,CAAC,KAAK,GAAG,QAAQ,GAAG,uBAAuB;QAC1F,MAAM,YAAY,KAAK,IAAI,CAAC,KAAK;QACjC,MAAM,aAAa,KAAK,UAAU,IAAI,OAAO,gCAAgC;QAE7E,OAAO;YACL;YACA;YACA;YACA;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,MAAM,IAAI,MAAM,CAAC,8BAA8B,EAAE,AAAC,MAAgB,OAAO,EAAE;IAC7E;AACF"}},
    {"offset": {"line": 470, "column": 0}, "map": {"version":3,"sources":["file:///Users/ryanbartell/ski-conditions-aggregator/app/api/scrape/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport * as cheerio from 'cheerio';\nimport { resorts } from '../../../lib/resorts';\nimport { Conditions } from '../../../lib/types';\nimport { getNWSObservation, NWSObservation } from '../../../lib/nws';\nimport { fetchCurrentWeather } from '../../../lib/weather';\n\n// Resort-specific scraping removed. All logic now uses NWS-based predictive model.\nasync function scrapeResortConditions(url: string, resortId?: string): Promise<any> {\n  // No-op: always return zeros/nulls for legacy fields\n  return { snowDepth: 0, recentSnowfall: 0, trailOpen: 0, trailTotal: 0, groomed: 0, baseTemp: null, windSpeed: null, visibility: null, rawHtml: null };\n}\n\nexport async function GET(request: NextRequest) {\n  const { searchParams } = new URL(request.url);\n  const resortId = searchParams.get('resortId');\n\n  if (!resortId) {\n    return NextResponse.json({ error: 'resortId required' }, { status: 400 });\n  }\n\n  const resort = resorts.find(r => r.id === resortId);\n  if (!resort) {\n    return NextResponse.json({ error: 'Resort not found' }, { status: 404 });\n  }\n\n  try {\n    // Fetch OpenWeather data for snowfall\n    let weatherData = null;\n    try {\n      weatherData = await fetchCurrentWeather(resort.lat, resort.lon);\n    } catch (e) {\n      console.warn(`Failed to fetch weather for ${resort.name}:`, e);\n      weatherData = null;\n    }\n\n    // Fetch NWS weather for additional data\n    let nws: NWSObservation | null = null;\n    try {\n      nws = await getNWSObservation(resort.lat, resort.lon);\n    } catch (e) {\n      nws = null;\n    }\n\n    // Use real snowfall data from OpenWeather, fallback to NWS-based prediction\n    const recentSnowfall = weatherData?.snowDepth || 0;\n    const snowDepth = weatherData?.snowDepth || 0;\n\n    // Predict resort conditions from NWS data (rules-based model)\n    const elevationDiffFt = 2000; // TODO: use real elevation data\n    const baseTemp = weatherData?.temp || (nws && nws.temperature !== null ? (nws.temperature * 9/5 + 32) - (elevationDiffFt / 1000) * 3 : 0);\n    const windSpeed = weatherData?.windSpeed || (nws && nws.windSpeed !== null ? nws.windSpeed * 0.621371 : 0); // km/h to mph\n    const visibility = nws ? nws.textDescription : 'Unknown';\n\n    // Trail data is not available from our sources, so set to 0\n    const trailOpen = 0;\n    const trailTotal = 0;\n    const groomed = 0;\n\n    const conditions: Conditions = {\n      resortId,\n      timestamp: new Date(),\n      snowDepth,\n      recentSnowfall,\n      baseTemp,\n      windSpeed,\n      visibility,\n      trailStatus: { open: trailOpen, total: trailTotal, groomed },\n      rawData: { nws },\n    };\n\n    // TODO: Store in Supabase\n\n    return NextResponse.json(conditions);\n  } catch (error) {\n    // If error is from scraping, return a clear error message\n    return NextResponse.json({ error: (error as Error).message, type: 'scrape-failed' }, { status: 502 });\n  }\n}"],"names":[],"mappings":";;;;AAAA;AAEA;AAEA;AACA;;;;;AAEA,mFAAmF;AACnF,eAAe,uBAAuB,GAAW,EAAE,QAAiB;IAClE,qDAAqD;IACrD,OAAO;QAAE,WAAW;QAAG,gBAAgB;QAAG,WAAW;QAAG,YAAY;QAAG,SAAS;QAAG,UAAU;QAAM,WAAW;QAAM,YAAY;QAAM,SAAS;IAAK;AACtJ;AAEO,eAAe,IAAI,OAAoB;IAC5C,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;IAC5C,MAAM,WAAW,aAAa,GAAG,CAAC;IAElC,IAAI,CAAC,UAAU;QACb,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAoB,GAAG;YAAE,QAAQ;QAAI;IACzE;IAEA,MAAM,SAAS,2HAAO,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;IAC1C,IAAI,CAAC,QAAQ;QACX,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAmB,GAAG;YAAE,QAAQ;QAAI;IACxE;IAEA,IAAI;QACF,sCAAsC;QACtC,IAAI,cAAc;QAClB,IAAI;YACF,cAAc,MAAM,IAAA,uIAAmB,EAAC,OAAO,GAAG,EAAE,OAAO,GAAG;QAChE,EAAE,OAAO,GAAG;YACV,QAAQ,IAAI,CAAC,CAAC,4BAA4B,EAAE,OAAO,IAAI,CAAC,CAAC,CAAC,EAAE;YAC5D,cAAc;QAChB;QAEA,wCAAwC;QACxC,IAAI,MAA6B;QACjC,IAAI;YACF,MAAM,MAAM,IAAA,iIAAiB,EAAC,OAAO,GAAG,EAAE,OAAO,GAAG;QACtD,EAAE,OAAO,GAAG;YACV,MAAM;QACR;QAEA,4EAA4E;QAC5E,MAAM,iBAAiB,aAAa,aAAa;QACjD,MAAM,YAAY,aAAa,aAAa;QAE5C,8DAA8D;QAC9D,MAAM,kBAAkB,MAAM,gCAAgC;QAC9D,MAAM,WAAW,aAAa,QAAQ,CAAC,OAAO,IAAI,WAAW,KAAK,OAAO,AAAC,IAAI,WAAW,GAAG,IAAE,IAAI,KAAM,AAAC,kBAAkB,OAAQ,IAAI,CAAC;QACxI,MAAM,YAAY,aAAa,aAAa,CAAC,OAAO,IAAI,SAAS,KAAK,OAAO,IAAI,SAAS,GAAG,WAAW,CAAC,GAAG,cAAc;QAC1H,MAAM,aAAa,MAAM,IAAI,eAAe,GAAG;QAE/C,4DAA4D;QAC5D,MAAM,YAAY;QAClB,MAAM,aAAa;QACnB,MAAM,UAAU;QAEhB,MAAM,aAAyB;YAC7B;YACA,WAAW,IAAI;YACf;YACA;YACA;YACA;YACA;YACA,aAAa;gBAAE,MAAM;gBAAW,OAAO;gBAAY;YAAQ;YAC3D,SAAS;gBAAE;YAAI;QACjB;QAEA,0BAA0B;QAE1B,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,OAAO;QACd,0DAA0D;QAC1D,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,AAAC,MAAgB,OAAO;YAAE,MAAM;QAAgB,GAAG;YAAE,QAAQ;QAAI;IACrG;AACF"}}]
}