{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/ryanbartell/ski-conditions-aggregator/app/api/radar/frames/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\n\nexport const dynamic = 'force-dynamic';\nexport const revalidate = 300; // Cache for 5 minutes\n\n/**\n * Radar Frames API - Returns timestamps for precipitation radar animation\n * \n * Data Source: RainViewer.com API\n * Reference: https://www.rainviewer.com/api.html\n * \n * Coverage: 10-minute intervals, 48-hour history (96 frames)\n * Updates: Every 10 minutes\n * Global Coverage: Worldwide precipitation radar\n */\nexport async function GET(request: Request) {\n  try {\n    console.log('[Radar Frames] Fetching RainViewer API...');\n    \n    // Get current RainViewer radar layers\n    // This returns both historical and forecast layers with timestamps\n    const res = await fetch('https://api.rainviewer.com/public/weather-maps-api-v2/GetWeatherMapsList', {\n      method: 'GET',\n      headers: {\n        'User-Agent': 'ski-conditions-aggregator'\n      }\n    });\n\n    if (!res.ok) {\n      console.error('[Radar Frames] RainViewer API error:', res.status);\n      throw new Error(`RainViewer returned ${res.status}`);\n    }\n\n    const data = await res.json();\n    console.log('[Radar Frames] RainViewer response:', data);\n\n    // Extract historical radar layers (past 48 hours at 10-min intervals)\n    // RainViewer returns: { radar: { nowcast: [...], archive: [...] } }\n    const archiveLayers = data?.radar?.archive || [];\n    \n    if (archiveLayers.length === 0) {\n      console.warn('[Radar Frames] No archive layers found, using fallback');\n      return fallbackResponse();\n    }\n\n    // Each archive layer has { time: millisecondsSinceEpoch, url: \"tile URL pattern\" }\n    // Extract just the timestamps and base URLs\n    const layers = archiveLayers.map((layer: any) => ({\n      timestamp: layer.time,\n      url: layer.url, // e.g., \"https://tile.rainviewer.com/v2/radar/...\"\n    }));\n\n    console.log(`[Radar Frames] Got ${layers.length} archive layers covering 48h`);\n\n    const result = {\n      radar: {\n        layers: layers,\n        source: 'rainviewer-48h'\n      },\n      metadata: {\n        count: layers.length,\n        source: 'rainviewer-api-v2',\n        updateFrequency: '10 minutes',\n        coverage: 'Worldwide',\n        timeRange: 'Last 48 hours (10-min intervals)',\n        reference: 'https://www.rainviewer.com/api.html'\n      }\n    };\n\n    const res2 = NextResponse.json(result);\n    res2.headers.set('Cache-Control', 'public, max-age=300');\n    res2.headers.set('Access-Control-Allow-Origin', '*');\n    return res2;\n\n  } catch (error: any) {\n    console.error('[Radar Frames] Error:', error.message);\n    return fallbackResponse();\n  }\n}\n\nfunction fallbackResponse() {\n  // Fallback: Return Mesonet format (1-hour, 12 frames) if RainViewer fails\n  const layers = [\n    'nexrad-n0q-m55m',\n    'nexrad-n0q-m50m',\n    'nexrad-n0q-m45m',\n    'nexrad-n0q-m40m',\n    'nexrad-n0q-m35m',\n    'nexrad-n0q-m30m',\n    'nexrad-n0q-m25m',\n    'nexrad-n0q-m20m',\n    'nexrad-n0q-m15m',\n    'nexrad-n0q-m10m',\n    'nexrad-n0q-m05m',\n    'nexrad-n0q',\n  ];\n\n  return NextResponse.json(\n    {\n      radar: { layers },\n      metadata: {\n        source: 'mesonet-fallback',\n        note: 'RainViewer failed, using 1-hour Mesonet data'\n      }\n    },\n    { status: 200 }\n  );\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEO,MAAM,UAAU;AAChB,MAAM,aAAa,KAAK,sBAAsB;AAY9C,eAAe,IAAI,OAAgB;IACxC,IAAI;QACF,QAAQ,GAAG,CAAC;QAEZ,sCAAsC;QACtC,mEAAmE;QACnE,MAAM,MAAM,MAAM,MAAM,4EAA4E;YAClG,QAAQ;YACR,SAAS;gBACP,cAAc;YAChB;QACF;QAEA,IAAI,CAAC,IAAI,EAAE,EAAE;YACX,QAAQ,KAAK,CAAC,wCAAwC,IAAI,MAAM;YAChE,MAAM,IAAI,MAAM,CAAC,oBAAoB,EAAE,IAAI,MAAM,EAAE;QACrD;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,QAAQ,GAAG,CAAC,uCAAuC;QAEnD,sEAAsE;QACtE,oEAAoE;QACpE,MAAM,gBAAgB,MAAM,OAAO,WAAW,EAAE;QAEhD,IAAI,cAAc,MAAM,KAAK,GAAG;YAC9B,QAAQ,IAAI,CAAC;YACb,OAAO;QACT;QAEA,mFAAmF;QACnF,4CAA4C;QAC5C,MAAM,SAAS,cAAc,GAAG,CAAC,CAAC,QAAe,CAAC;gBAChD,WAAW,MAAM,IAAI;gBACrB,KAAK,MAAM,GAAG;YAChB,CAAC;QAED,QAAQ,GAAG,CAAC,CAAC,mBAAmB,EAAE,OAAO,MAAM,CAAC,4BAA4B,CAAC;QAE7E,MAAM,SAAS;YACb,OAAO;gBACL,QAAQ;gBACR,QAAQ;YACV;YACA,UAAU;gBACR,OAAO,OAAO,MAAM;gBACpB,QAAQ;gBACR,iBAAiB;gBACjB,UAAU;gBACV,WAAW;gBACX,WAAW;YACb;QACF;QAEA,MAAM,OAAO,gJAAY,CAAC,IAAI,CAAC;QAC/B,KAAK,OAAO,CAAC,GAAG,CAAC,iBAAiB;QAClC,KAAK,OAAO,CAAC,GAAG,CAAC,+BAA+B;QAChD,OAAO;IAET,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,yBAAyB,MAAM,OAAO;QACpD,OAAO;IACT;AACF;AAEA,SAAS;IACP,0EAA0E;IAC1E,MAAM,SAAS;QACb;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IAED,OAAO,gJAAY,CAAC,IAAI,CACtB;QACE,OAAO;YAAE;QAAO;QAChB,UAAU;YACR,QAAQ;YACR,MAAM;QACR;IACF,GACA;QAAE,QAAQ;IAAI;AAElB"}}]
}