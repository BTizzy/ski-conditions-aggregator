{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/ryanbartell/ski-conditions-aggregator/app/api/radar/frames/route.ts"],"sourcesContent":["\nimport { NextResponse } from 'next/server';\n\n// Example NOAA endpoints (public):\n// MRMS tiled PNGs: https://mrms.ncep.noaa.gov/data/2D/PrecipRate/ (z/x/y.png)\n// NEXRAD tiled: https://mesonet.agron.iastate.edu/cgi-bin/wms/nexrad/n0r.cgi (WMS)\n// QPE tiled: https://mesonet.agron.iastate.edu/cgi-bin/wms/us/mrms.cgi (WMS)\n\n// For demo: Use Iowa State Mesonet for frame times (NEXRAD, MRMS, QPE)\nconst SOURCES = [\n  {\n    name: 'NEXRAD',\n    url: 'https://mesonet.agron.iastate.edu/json/radar/nexrad_n0q.json',\n    parse: (json: any) => (json && json.timestamps ? json.timestamps : [])\n  },\n  {\n    name: 'MRMS',\n    url: 'https://mesonet.agron.iastate.edu/json/radar/mrms_ref.json',\n    parse: (json: any) => (json && json.timestamps ? json.timestamps : [])\n  },\n  {\n    name: 'QPE',\n    url: 'https://mesonet.agron.iastate.edu/json/radar/mrms_qpe.json',\n    parse: (json: any) => (json && json.timestamps ? json.timestamps : [])\n  }\n];\n\nexport async function GET() {\n  try {\n    // Fetch all sources in parallel\n    const results = await Promise.all(\n      SOURCES.map(async (src) => {\n        try {\n          const res = await fetch(src.url);\n          if (!res.ok) return [];\n          const json = await res.json();\n          return src.parse(json).map((t: string) => ({ time: t, source: src.name }));\n        } catch {\n          return [];\n        }\n      })\n    );\n    // Merge and deduplicate frames by time (ISO8601 or epoch seconds)\n    const allFrames = ([] as any[]).concat(...results);\n    // Sort descending (most recent first)\n    allFrames.sort((a, b) => (a.time < b.time ? 1 : -1));\n    // Remove duplicates (keep all sources for a time)\n    const seen = new Set();\n    const merged = allFrames.filter(f => {\n      if (seen.has(f.time)) return false;\n      seen.add(f.time);\n      return true;\n    });\n    const response = NextResponse.json({ frames: merged });\n    response.headers.set('Access-Control-Allow-Origin', '*');\n    return response;\n  } catch (e: any) {\n    return NextResponse.json({ error: 'fetch_failed', message: String(e) }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AACA;;AAEA,mCAAmC;AACnC,8EAA8E;AAC9E,mFAAmF;AACnF,6EAA6E;AAE7E,uEAAuE;AACvE,MAAM,UAAU;IACd;QACE,MAAM;QACN,KAAK;QACL,OAAO,CAAC,OAAe,QAAQ,KAAK,UAAU,GAAG,KAAK,UAAU,GAAG,EAAE;IACvE;IACA;QACE,MAAM;QACN,KAAK;QACL,OAAO,CAAC,OAAe,QAAQ,KAAK,UAAU,GAAG,KAAK,UAAU,GAAG,EAAE;IACvE;IACA;QACE,MAAM;QACN,KAAK;QACL,OAAO,CAAC,OAAe,QAAQ,KAAK,UAAU,GAAG,KAAK,UAAU,GAAG,EAAE;IACvE;CACD;AAEM,eAAe;IACpB,IAAI;QACF,gCAAgC;QAChC,MAAM,UAAU,MAAM,QAAQ,GAAG,CAC/B,QAAQ,GAAG,CAAC,OAAO;YACjB,IAAI;gBACF,MAAM,MAAM,MAAM,MAAM,IAAI,GAAG;gBAC/B,IAAI,CAAC,IAAI,EAAE,EAAE,OAAO,EAAE;gBACtB,MAAM,OAAO,MAAM,IAAI,IAAI;gBAC3B,OAAO,IAAI,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC,IAAc,CAAC;wBAAE,MAAM;wBAAG,QAAQ,IAAI,IAAI;oBAAC,CAAC;YAC1E,EAAE,OAAM;gBACN,OAAO,EAAE;YACX;QACF;QAEF,kEAAkE;QAClE,MAAM,YAAY,AAAC,EAAE,CAAW,MAAM,IAAI;QAC1C,sCAAsC;QACtC,UAAU,IAAI,CAAC,CAAC,GAAG,IAAO,EAAE,IAAI,GAAG,EAAE,IAAI,GAAG,IAAI,CAAC;QACjD,kDAAkD;QAClD,MAAM,OAAO,IAAI;QACjB,MAAM,SAAS,UAAU,MAAM,CAAC,CAAA;YAC9B,IAAI,KAAK,GAAG,CAAC,EAAE,IAAI,GAAG,OAAO;YAC7B,KAAK,GAAG,CAAC,EAAE,IAAI;YACf,OAAO;QACT;QACA,MAAM,WAAW,gJAAY,CAAC,IAAI,CAAC;YAAE,QAAQ;QAAO;QACpD,SAAS,OAAO,CAAC,GAAG,CAAC,+BAA+B;QACpD,OAAO;IACT,EAAE,OAAO,GAAQ;QACf,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;YAAgB,SAAS,OAAO;QAAG,GAAG;YAAE,QAAQ;QAAI;IACxF;AACF"}}]
}