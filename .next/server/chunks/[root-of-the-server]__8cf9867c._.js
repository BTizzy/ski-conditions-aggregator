module.exports=[24361,(e,r,t)=>{r.exports=e.x("util",()=>require("util"))},93695,(e,r,t)=>{r.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},32319,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},18622,(e,r,t)=>{r.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,r,t)=>{r.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},70406,(e,r,t)=>{r.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},34071,(e,r,t)=>{r.exports=e.x("canvas-40599359ff5e39db",()=>require("canvas-40599359ff5e39db"))},83075,e=>{"use strict";var r=e.i(34071);class t{sources=[];frameCache=new Map;tileCache=new Map;lastUpdate=0;CACHE_DURATION=3e5;constructor(){this.initializeSources()}initializeSources(){this.sources.push(new a),this.sources.push(new s),this.sources.push(new i),this.sources.push(new o),this.sources.push(new l),this.sources.push(new f),this.sources.push(new p),this.sources.push(new m),this.sources.push(new n),this.sources.push(new u),this.sources.push(new c),this.sources.push(new y),this.sources.push(new g),this.sources.push(new w),this.sources.push(new h),this.sources.push(new v),this.sources.push(new d),this.sources.sort((e,r)=>r.priority-e.priority)}async getFrames(){let e=Date.now();if(e-this.lastUpdate<this.CACHE_DURATION&&this.frameCache.has("all"))return this.tileCache.clear(),this.frameCache.get("all");this.frameCache.clear(),this.tileCache.clear();let r=[],t=this.sources.map(e=>this.safeFetchFrames(e));(await Promise.allSettled(t)).forEach((e,t)=>{"fulfilled"===e.status&&e.value&&r.push(...e.value)});let a=this.deduplicateFrames(r);return a.sort((e,r)=>e.time-r.time),this.frameCache.set("all",a),this.lastUpdate=e,a}async safeFetchFrames(e){try{return await e.fetchFrames()}catch(r){return console.warn(`[RadarManager] Failed to fetch from ${e.name}:`,r),null}}deduplicateFrames(e){let r=new Set;return e.filter(e=>{let t=`${e.time}-${e.source}`;return!r.has(t)&&(r.add(t),!0)})}async getTile(e,r,t,a){let s=`${e}-${r}-${t}-${a}`;if(this.tileCache.has(s))return this.tileCache.get(s);for(let i of[...this.sources].sort((e,r)=>r.priority-e.priority))try{let o={time:e,url:`${i.name}-${e}`,source:i.name,coverage:i.coverage,quality:4},l=await i.fetchTile(o,r,t,a);if(l){if(this.tileCache.set(s,l),this.tileCache.size>1e3){let e=this.tileCache.keys().next().value;e&&this.tileCache.delete(e)}return console.log(`[RadarManager] Served tile from ${i.name}`),l}}catch(e){console.warn(`[RadarManager] Failed to fetch tile from ${i.name}:`,e)}return console.log(`[RadarManager] No source could provide tile for time=${e} z=${r} x=${t} y=${a}`),null}findBestFrame(e,r){let t=e.filter(e=>18e5>=Math.abs(e.time-r));return 0===t.length?null:(t.sort((e,t)=>e.quality!==t.quality?t.quality-e.quality:Math.abs(e.time-r)-Math.abs(t.time-r)),t[0])}getSourceInfo(){return this.sources.map(e=>({name:e.name,priority:e.priority,coverage:e.coverage,maxHistoryHours:e.maxHistoryHours,requiresApiKey:e.requiresApiKey}))}}class a{name="noaa";priority=100;coverage="US";maxHistoryHours=1;requiresApiKey=!1;async fetchFrames(){let e=Date.now();return[{time:e,url:`noaa-${e}`,source:this.name,coverage:"northeast",quality:5}]}async fetchTile(e,r,t,a){try{let e=`https://mesonet.agron.iastate.edu/cache/tile.py/1.0.0/nexrad-n0q-900913/${r}/${t}/${a}.png`,s=await fetch(e,{headers:{"User-Agent":"Mozilla/5.0 (compatible; ski-conditions-aggregator)",Referer:"https://mesonet.agron.iastate.edu/"}});if(!s.ok)return console.warn(`[NOAA] Tile fetch failed: ${s.status} for ${e}`),null;let i=await s.arrayBuffer(),o=Buffer.from(i);return this.processNEXRADColors(o)}catch(e){return console.warn("[NOAA] Tile fetch error:",e),null}}processNEXRADColors(t){let a=(0,r.createCanvas)(256,256),s=a.getContext("2d"),i=new(e.r(34071)).Image;i.src=t,s.drawImage(i,0,0);let o=s.getImageData(0,0,256,256),l=o.data,n=(e,r,t,a)=>{if(0===a)return[0,0,0,0];let s=-32+Math.max(e,r,t)/255*127;return s<0?[0,0,0,0]:s<5?[0,100,255,120]:s<10?[0,150,255,140]:s<15?[0,200,255,160]:s<20?[0,255,200,180]:s<25?[0,255,100,200]:s<30?[100,255,0,220]:s<35?[150,255,0,240]:s<40?[255,255,0,255]:s<45?[255,200,0,255]:s<50?[255,150,0,255]:s<55?[255,100,0,255]:s<60?[255,0,100,255]:s<65?[200,0,150,255]:[150,0,200,255]};for(let e=0;e<l.length;e+=4){let[r,t,a,s]=n(l[e],l[e+1],l[e+2],l[e+3]);l[e]=r,l[e+1]=t,l[e+2]=a,l[e+3]=s}return s.putImageData(o,0,0),a.toBuffer("image/png")}}class s{name="rainviewer";priority=90;coverage="global";maxHistoryHours=2;requiresApiKey=!1;async fetchFrames(){try{let e=await fetch("https://api.rainviewer.com/public/weather-maps.json");if(!e.ok)throw Error("RainViewer API failed");let r=await e.json(),t=[];return r.radar&&r.radar.past&&r.radar.past.forEach(e=>{let r=1e3*e.time;t.push({time:r,url:`rainviewer-${r}`,source:this.name,coverage:"global",quality:4})}),t}catch(e){return console.warn("[RainViewer] Failed to fetch frames:",e),[]}}async fetchTile(e,r,t,a){try{let s=e.url.split("-")[1];if(!s)return null;let i=`https://tilecache.rainviewer.com/v2/radar/${s}/256/${r}/${t}/${a}/1/1_1.png`,o=await fetch(i,{headers:{"User-Agent":"Mozilla/5.0 (compatible; ski-conditions-aggregator)",Referer:"https://www.rainviewer.com/"}});if(!o.ok)return console.warn(`[RainViewer] Tile fetch failed: ${o.status} for ${i}`),null;let l=await o.arrayBuffer();return Buffer.from(l)}catch(e){return console.warn("[RainViewer] Tile fetch error:",e),null}}}class i{name="windy";priority=80;coverage="global";maxHistoryHours=6;requiresApiKey=!1;async fetchFrames(){let e=[],r=Date.now();for(let t=0;t<24;t++){let a=r-15*t*6e4;e.push({time:a,url:`windy-${Math.floor(a/1e3)}`,source:this.name,coverage:"global",quality:4})}return e}async fetchTile(e,r,t,a){try{let s=e.url.split("-")[1],i=`https://tiles.windy.com/radar/${s}/${r}/${t}/${a}.png`,o=await fetch(i);if(!o.ok)return null;let l=await o.arrayBuffer();return Buffer.from(l)}catch(e){return null}}}class o{name="openweathermap";priority=95;coverage="global";maxHistoryHours=2;requiresApiKey=!0;async fetchFrames(){try{let e=[],r=Date.now();for(let t=0;t<12;t++){let a=r-10*t*6e4;e.push({time:a,url:`openweathermap-${Math.floor(a/1e3)}`,source:this.name,coverage:"global",quality:4})}return e}catch(e){return console.warn("[OpenWeatherMap] Failed to generate frames:",e),[]}}async fetchTile(e,r,t,a){try{let s=e.url.split("-")[1],i=600*Math.floor(parseInt(s)/600),o=`https://maps.openweathermap.org/maps/2.0/radar/forecast/${r}/${t}/${a}?appid=demo&tm=${i}`,l=await fetch(o);if(!l.ok)return null;let n=await l.arrayBuffer();return Buffer.from(n)}catch(e){return null}}}class l{name="iowastate";priority=95;coverage="US";maxHistoryHours=24;requiresApiKey=!1;async fetchFrames(){let e=[],r=Date.now();for(let t=0;t<144;t++){let a=r-10*t*6e4;e.push({time:a,url:`iowastate-${a}`,source:this.name,coverage:"conus",quality:4})}return e}async fetchTile(e,r,t,a){try{let e=`https://mesonet.agron.iastate.edu/cache/tile.py/1.0.0/nexrad-n0q-900913/${r}/${t}/${a}.png`,s=await fetch(e,{headers:{"User-Agent":"Mozilla/5.0 (compatible; ski-conditions-aggregator)",Referer:"https://mesonet.agron.iastate.edu/"}});if(!s.ok)return null;let i=await s.arrayBuffer();return Buffer.from(i)}catch(e){return null}}}class n{name="wunderground";priority=75;coverage="global";maxHistoryHours=6;requiresApiKey=!1;async fetchFrames(){let e=[],r=Date.now();for(let t=0;t<24;t++){let a=r-15*t*6e4;e.push({time:a,url:`wunderground-${Math.floor(a/1e3)}`,source:this.name,coverage:"global",quality:3})}return e}async fetchTile(e,r,t,a){try{let e=`https://tile.wunderground.com/tile/radar/${r}/${t}/${a}.png`,s=await fetch(e);if(!s.ok)return null;let i=await s.arrayBuffer();return Buffer.from(i)}catch(e){return null}}}class u{name="zoomearth";priority=70;coverage="global";maxHistoryHours=24;requiresApiKey=!1;async fetchFrames(){let e=[],r=Date.now();for(let t=0;t<48;t++){let a=r-30*t*6e4;e.push({time:a,url:`zoomearth-${Math.floor(a/1e3)}`,source:this.name,coverage:"global",quality:4})}return e}async fetchTile(e,r,t,a){try{let s=e.url.split("-")[1],i=`https://tiles.zoomearth.com/precipitation/${s}/${r}/${t}/${a}.png`,o=await fetch(i);if(!o.ok)return null;let l=await o.arrayBuffer();return Buffer.from(l)}catch(e){return null}}}class c{name="ventusky";priority=65;coverage="global";maxHistoryHours=24;requiresApiKey=!1;async fetchFrames(){let e=[],r=Date.now();for(let t=0;t<24;t++){let a=r-60*t*6e4;e.push({time:a,url:`ventusky-${Math.floor(a/1e3)}`,source:this.name,coverage:"global",quality:4})}return e}async fetchTile(e,r,t,a){try{let s=e.url.split("-")[1],i=`https://tiles.ventusky.com/${s}/radar/${r}/${t}/${a}.png`,o=await fetch(i);if(!o.ok)return null;let l=await o.arrayBuffer();return Buffer.from(l)}catch(e){return null}}}class h{name="myradar";priority=80;coverage="global";maxHistoryHours=2;requiresApiKey=!1;async fetchFrames(){try{let e=await fetch("https://api.rainviewer.com/public/weather-maps.json");if(!e.ok)throw Error("MyRadar API failed");let r=await e.json(),t=[];return r.radar&&r.radar.past&&r.radar.past.forEach(e=>{t.push({time:1e3*e.time,url:`myradar-${e.time}`,source:this.name,coverage:"global",quality:4})}),t}catch(e){return console.warn("[MyRadar] Failed to fetch frames:",e),[]}}async fetchTile(e,r,t,a){try{let s=e.url.split("-")[1],i=`https://tilecache.rainviewer.com/v2/radar/${s}/${r}/${t}/${a}/256/png`,o=await fetch(i);if(!o.ok)return null;let l=await o.arrayBuffer();return Buffer.from(l)}catch(e){return null}}}class f{name="collegedupage";priority=82;coverage="regional";maxHistoryHours=24;requiresApiKey=!1;async fetchFrames(){let e=[],r=Date.now();for(let t=0;t<48;t++){let a=r-30*t*6e4;e.push({time:a,url:`collegedupage-${a}`,source:this.name,coverage:"regional",quality:4})}return e}async fetchTile(e,r,t,a){return null}}class p{name="ncar";priority=83;coverage="US";maxHistoryHours=24;requiresApiKey=!1;async fetchFrames(){let e=[],r=Date.now();for(let t=0;t<48;t++){let a=r-30*t*6e4;e.push({time:a,url:`ncar-${a}`,source:this.name,coverage:"US",quality:4})}return e}async fetchTile(e,r,t,a){return null}}class m{name="aviationweather";priority=95;coverage="US";maxHistoryHours=2;requiresApiKey=!1;async fetchFrames(){let e=[],r=Date.now();for(let t=0;t<8;t++){let a=r-15*t*6e4;e.push({time:a,url:`aviation-${a}`,source:this.name,coverage:"US",quality:5})}return e}async fetchTile(e,r,t,a){return null}}class y{name="noaa-radar-viewer";priority=98;coverage="US";maxHistoryHours=1;requiresApiKey=!1;async fetchFrames(){let e=[],r=Date.now();for(let t=0;t<6;t++){let a=r-10*t*6e4;e.push({time:a,url:`noaa-viewer-${a}`,source:this.name,coverage:"US",quality:5})}return e}async fetchTile(e,r,t,a){return null}}class g{name="noaa-mosaics";priority=97;coverage="US";maxHistoryHours=2;requiresApiKey=!1;async fetchFrames(){let e=[],r=Date.now();for(let t=0;t<12;t++){let a=r-10*t*6e4;e.push({time:a,url:`noaa-mosaic-${a}`,source:this.name,coverage:"US",quality:5})}return e}async fetchTile(e,r,t,a){return null}}class w{name="goes-satellite";priority=60;coverage="north-america";maxHistoryHours=24;requiresApiKey=!1;async fetchFrames(){let e=[],r=Date.now();for(let t=0;t<48;t++){let a=r-30*t*6e4;e.push({time:a,url:`goes-${a}`,source:this.name,coverage:"north-america",quality:3})}return e}async fetchTile(e,r,t,a){return null}}class d{name="synthetic";priority=10;coverage="northeast-us";maxHistoryHours=48;requiresApiKey=!1;async fetchFrames(){let e=[],r=Date.now();for(let t=0;t<48;t++){let a=r-60*t*6e4;e.push({time:a,url:`/api/radar/synthetic?hour=${t}`,source:this.name,coverage:"northeast-us",quality:5})}return e}async fetchTile(e,r,t,a){let s=e.url.match(/hour=(\d+)/);if(!s)return null;let i=parseInt(s[1]);if(isNaN(i)||i<0||i>47)return null;try{let e=await fetch(`http://localhost:3000/api/radar/synthetic?hour=${i}&z=${r}&x=${t}&y=${a}`);if(!e.ok)return null;let s=await e.arrayBuffer();return Buffer.from(s)}catch(e){return console.error("[Synthetic Source] Fetch error:",e),null}}}class v{name="weathergov";priority=78;coverage="US";maxHistoryHours=2;requiresApiKey=!1;async fetchFrames(){let e=[],r=Date.now();for(let t=0;t<8;t++){let a=r-15*t*6e4;e.push({time:a,url:`weathergov-${a}`,source:this.name,coverage:"US",quality:4})}return e}async fetchTile(e,r,t,a){return null}}let $=new t;e.s(["radarManager",0,$])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__8cf9867c._.js.map