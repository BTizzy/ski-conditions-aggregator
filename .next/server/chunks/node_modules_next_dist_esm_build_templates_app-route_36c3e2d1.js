module.exports=[57415,e=>{"use strict";var t=e.i(47909),n=e.i(74017),a=e.i(96250),r=e.i(59756),o=e.i(61916),l=e.i(74677),i=e.i(19163),s=e.i(16795),d=e.i(87718),c=e.i(95169),u=e.i(47587),p=e.i(66012),h=e.i(70101),f=e.i(26937),w=e.i(10372),g=e.i(93695);e.i(52474);var m=e.i(220),R=e.i(89171),v=e.i(34071);let y=null,x=0;async function C(e){console.log("[Synthetic Tile] Request:",e.url);try{let{searchParams:t}=e.nextUrl,n=parseInt(t.get("hour")||"0"),a=parseInt(t.get("z")||"7"),r=parseInt(t.get("x")||"0"),o=parseInt(t.get("y")||"0");if(isNaN(n)||n<0||n>47||a<0||a>18)return S();let l=Math.pow(2,a);if(r<0||r>=l||o<0||o>=l)return S();let i=await E();if(!i||0===i.length)return S();console.log(`[Synthetic Tile] Hour ${n}: ${i.length} resorts loaded`),console.log("[Synthetic Tile] Sample resorts:",i.slice(0,3).map(e=>({name:e.name,lat:e.lat,lon:e.lon,snowfall:e.recentSnowfall})));let s=function(e,t){let n=47-t;if(!e||0===e.length)return console.warn("[Storm Evolution] No current conditions provided"),[];if(t<0||t>47)return console.warn("[Storm Evolution] Invalid hour offset:",t),e;let a=45*Math.PI/180,r=35/111.32*Math.cos(a),o=35/111.32*Math.sin(a);return e.map(e=>{let t;if(!e||"number"!=typeof e.lat||"number"!=typeof e.lon)return console.warn("[Storm Evolution] Invalid resort data:",e),e;let a=e.lat-r*n,l=e.lon-o*n,i=n/47;t=i<.2?1:i<.5?.8-(i-.2)/.3*.4:.4*Math.pow(1-(i-.5)/.5,2);let s=Math.max(0,e.recentSnowfall*t);return{...e,lat:a,lon:l,recentSnowfall:s}})}(i,n);console.log("[Synthetic Tile] After storm evolution:",s.slice(0,3).map(e=>({name:e.name,lat:e.lat.toFixed(4),lon:e.lon.toFixed(4),snowfall:e.recentSnowfall.toFixed(2)})));let d=function(e,t,n,a,r){let o=(0,v.createCanvas)(256,256),l=o.getContext("2d"),i=Math.pow(2,t);console.log(`[Tile Generation] z=${t} x=${n} y=${a}, ${e.length} conditions`);let s=l.createImageData(256,256),d=s.data,c=0;for(let t=0;t<256;t++)for(let r=0;r<256;r++){let o=(n+r/256)/i*360-180,l=180*Math.atan(Math.sinh(Math.PI*(1-2*(a+t/256)/i)))/Math.PI,s=function(e,t,n=6,a=5){if(0===t.length)return 0;console.log(`[IDW] Interpolating at (${e.lat.toFixed(4)}, ${e.lon.toFixed(4)}), ${t.length} samples`);let r=t.map(t=>({sample:t,dist:function(e,t){let n=(t.lat-e.lat)*111,a=(t.lon-e.lon)*111*Math.cos(e.lat*Math.PI/180);return Math.sqrt(n*n+a*a)/111}(e,{lat:t.lat,lon:t.lon})})).filter(e=>e.dist<=a).sort((e,t)=>e.dist-t.dist);if(0===r.length)return 0;let o=r.slice(0,n),l=o.map(e=>0===e.dist?1e3:1/Math.pow(e.dist+.1,2.5)),i=l.reduce((e,t)=>e+t,0);return o.reduce((e,t,n)=>e+t.sample.recentSnowfall*(l[n]/i),0)}({lat:l,lon:o},e,6,5);128===r&&128===t&&console.log(`[Tile] Center pixel snowfall: ${s.toFixed(3)} inches at (${l.toFixed(4)}, ${o.toFixed(4)})`);let u=new Uint8ClampedArray(s>=8?[255,0,255,255]:s>=4?[255,0,0,230]:s>=2?[255,165,0,204]:s>=1?[255,255,0,178]:s>=.5?[0,255,0,153]:s>=.1?[144,238,144,102]:s>=.05?[224,255,255,51]:[0,0,0,0]);d[c++]=u[0],d[c++]=u[1],d[c++]=u[2],d[c++]=u[3]}return l.putImageData(s,0,0),function(e,t,n,a=1.5){let r=e.getImageData(0,0,256,256),o=r.data,l=new Uint8ClampedArray(o),i=2*Math.ceil(3*a)+1,s=function(e,t){let n=[],a=Math.floor(e/2),r=0;for(let o=0;o<e;o++){n[o]=[];for(let l=0;l<e;l++){let e=l-a,i=o-a,s=Math.exp(-(e*e+i*i)/(2*t*t));n[o][l]=s,r+=s}}for(let t=0;t<e;t++)for(let a=0;a<e;a++)n[t][a]/=r;return n}(i,a);for(let e=0;e<4;e++)for(let t=0;t<256;t++)for(let n=0;n<256;n++){let a=0,r=0;for(let l=0;l<i;l++)for(let d=0;d<i;d++){let c=n+d-Math.floor(i/2),u=t+l-Math.floor(i/2);if(c>=0&&c<256&&u>=0&&u<256){let t=s[l][d];a+=o[(256*u+c)*4+e]*t,r+=t}}let d=(256*t+n)*4+e;l[d]=r>0?a/r:o[d]}for(let e=0;e<o.length;e++)o[e]=l[e];e.putImageData(r,0,0)}(l,256,256,.5),o.toBuffer("image/png")}(s,a,r,o,new Date(Date.now()-(47-n)*36e5));return new R.NextResponse(new Uint8Array(d),{headers:{"Content-Type":"image/png","Cache-Control":"public, max-age=60","Access-Control-Allow-Origin":"*"}})}catch(e){return console.error("[Synthetic Radar] Error:",e.message),S()}}async function E(){let e=Date.now();if(y&&e-x<3e5)return y;try{let t=await fetch(`${process.env.NEXT_PUBLIC_API_URL||"http://localhost:3000"}/api/resorts/conditions`,{next:{revalidate:60}});if(!t.ok)return[];let n=await t.json(),a=n.resorts?.map(e=>({id:e.id,name:e.name,lat:e.lat,lon:e.lon,snowDepth:e.conditions?.snowDepth||0,recentSnowfall:e.conditions?.recentSnowfall||0,weeklySnowfall:e.conditions?.weeklySnowfall,baseTemp:e.conditions?.baseTemp||20,windSpeed:e.conditions?.windSpeed||0,visibility:e.conditions?.visibility||"Good"}))||[];return y=a,x=e,a}catch(e){return console.warn("[Synthetic] Failed to fetch current resort conditions:",e),y||[]}}function S(){let e=Buffer.from([137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,0,0,0,1,0,0,0,1,8,6,0,0,0,31,21,196,137,0,0,0,10,73,68,65,84,120,156,99,0,1,0,0,5,0,1,13,10,45,180,0,0,0,0,73,69,78,68,174,66,96,130]);return new R.NextResponse(e,{headers:{"Content-Type":"image/png","Cache-Control":"public, max-age=60","Access-Control-Allow-Origin":"*"}})}e.s(["GET",()=>C,"dynamic",0,"force-dynamic","revalidate",0,60],56773);var A=e.i(56773);let T=new t.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/radar/synthetic/route",pathname:"/api/radar/synthetic",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/radar/synthetic/route.ts",nextConfigOutput:"",userland:A}),{workAsyncStorage:I,workUnitAsyncStorage:M,serverHooks:b}=T;function N(){return(0,a.patchFetch)({workAsyncStorage:I,workUnitAsyncStorage:M})}async function P(e,t,a){T.isDev&&(0,r.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let R="/api/radar/synthetic/route";R=R.replace(/\/index$/,"")||"/";let v=await T.prepare(e,t,{srcPage:R,multiZoneDraftMode:!1});if(!v)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:y,params:x,nextConfig:C,parsedUrl:E,isDraftMode:S,prerenderManifest:A,routerServerContext:I,isOnDemandRevalidate:M,revalidateOnlyGenerated:b,resolvedPathname:N,clientReferenceManifest:P,serverActionsManifest:D}=v,O=(0,i.normalizeAppPath)(R),_=!!(A.dynamicRoutes[O]||A.routes[N]),U=async()=>((null==I?void 0:I.render404)?await I.render404(e,t,E,!1):t.end("This page could not be found"),null);if(_&&!S){let e=!!A.routes[N],t=A.dynamicRoutes[O];if(t&&!1===t.fallback&&!e){if(C.experimental.adapterPath)return await U();throw new g.NoFallbackError}}let $=null;!_||T.isDev||S||($="/index"===($=N)?"/":$);let H=!0===T.isDev||!_,F=_&&!H;D&&P&&(0,l.setManifestsSingleton)({page:R,clientReferenceManifest:P,serverActionsManifest:D});let k=e.method||"GET",q=(0,o.getTracer)(),j=q.getActiveScopeSpan(),B={params:x,prerenderManifest:A,renderOpts:{experimental:{authInterrupts:!!C.experimental.authInterrupts},cacheComponents:!!C.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,r.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:C.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,n,a,r)=>T.onRequestError(e,t,a,r,I)},sharedContext:{buildId:y}},K=new s.NodeNextRequest(e),L=new s.NodeNextResponse(t),G=d.NextRequestAdapter.fromNodeNextRequest(K,(0,d.signalFromNodeResponse)(t));try{let l=async e=>T.handle(G,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let n=q.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=n.get("next.route");if(a){let t=`${k} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${k} ${R}`)}),i=!!(0,r.getRequestMeta)(e,"minimalMode"),s=async r=>{var o,s;let d=async({previousCacheEntry:n})=>{try{if(!i&&M&&b&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await l(r);e.fetchMetrics=B.renderOpts.fetchMetrics;let s=B.renderOpts.pendingWaitUntil;s&&a.waitUntil&&(a.waitUntil(s),s=void 0);let d=B.renderOpts.collectedTags;if(!_)return await (0,p.sendResponse)(K,L,o,B.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(o.headers);d&&(t[w.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let n=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=w.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,a=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=w.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:m.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:n,expire:a}}}}catch(t){throw(null==n?void 0:n.isStale)&&await T.onRequestError(e,t,{routerKind:"App Router",routePath:R,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:M})},!1,I),t}},c=await T.handleResponse({req:e,nextConfig:C,cacheKey:$,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:A,isRoutePPREnabled:!1,isOnDemandRevalidate:M,revalidateOnlyGenerated:b,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:i});if(!_)return null;if((null==c||null==(o=c.value)?void 0:o.kind)!==m.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(s=c.value)?void 0:s.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",M?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),S&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let g=(0,h.fromNodeOutgoingHttpHeaders)(c.value.headers);return i&&_||g.delete(w.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||g.get("Cache-Control")||g.set("Cache-Control",(0,f.getCacheControlHeader)(c.cacheControl)),await (0,p.sendResponse)(K,L,new Response(c.value.body,{headers:g,status:c.value.status||200})),null};j?await s(j):await q.withPropagatedContext(e.headers,()=>q.trace(c.BaseServerSpan.handleRequest,{spanName:`${k} ${R}`,kind:o.SpanKind.SERVER,attributes:{"http.method":k,"http.target":e.url}},s))}catch(t){if(t instanceof g.NoFallbackError||await T.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:M})},!1,I),_)throw t;return await (0,p.sendResponse)(K,L,new Response(null,{status:500})),null}}e.s(["handler",()=>P,"patchFetch",()=>N,"routeModule",()=>T,"serverHooks",()=>b,"workAsyncStorage",()=>I,"workUnitAsyncStorage",()=>M],57415)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_36c3e2d1.js.map