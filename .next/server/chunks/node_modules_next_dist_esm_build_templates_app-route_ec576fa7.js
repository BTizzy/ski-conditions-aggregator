module.exports=[93366,e=>{"use strict";var t=e.i(47909),a=e.i(74017),n=e.i(96250),r=e.i(59756),o=e.i(61916),i=e.i(74677),l=e.i(19163),s=e.i(16795),u=e.i(87718),p=e.i(95169),d=e.i(47587),c=e.i(66012),m=e.i(70101),h=e.i(26937),w=e.i(10372),f=e.i(93695);e.i(52474);var g=e.i(220),v=e.i(89171),y=e.i(36989);async function b(e,t){let a=`https://api.weather.gov/points/${e},${t}`,n=await fetch(a,{headers:{"User-Agent":"ski-conditions-aggregator"}});if(!n.ok)throw Error("Failed to get NWS gridpoint");let r=await n.json();return{office:r.properties.gridId,gridX:r.properties.gridX,gridY:r.properties.gridY}}async function M(e,t){let a=await b(e,t),n=`https://api.weather.gov/gridpoints/${a.office}/${a.gridX},${a.gridY}/forecast`,r=await fetch(n,{headers:{"User-Agent":"ski-conditions-aggregator"}});if(!r.ok)throw Error("Failed to get NWS forecast");let o=(await r.json()).properties.periods[0];return{temperature:o.temperature,windSpeed:o.windSpeed?parseInt(o.windSpeed):null,windDirection:o.windDirection||null,textDescription:o.shortForecast,icon:o.icon,timestamp:o.startTime,raw:o}}async function S(e,t){try{var a,n,r,o;let i,l,s,u,p=`https://api.weather.gov/points/${e},${t}`,d=await fetch(p,{headers:{"User-Agent":"ski-conditions-aggregator"}});if(!d.ok)return{stationId:null,distanceKm:null};let c=(await d.json()).properties.observationStations;if(!c)return{stationId:null,distanceKm:null};let m=await fetch(c,{headers:{"User-Agent":"ski-conditions-aggregator"}});if(!m.ok)return{stationId:null,distanceKm:null};let h=await m.json(),w=h.features||h;if(!w||0===w.length)return{stationId:null,distanceKm:null};let f=w[0],g=f&&f.geometry&&f.geometry.coordinates?f.geometry.coordinates:null;if(!g)return{stationId:f.properties?.stationIdentifier??null,distanceKm:null};let[v,y]=g,b=(a=e,n=t,r=y,o=v,l=(i=e=>e*Math.PI/180)(r-a),s=i(o-n),u=Math.sin(l/2)*Math.sin(l/2)+Math.cos(i(a))*Math.cos(i(r))*Math.sin(s/2)*Math.sin(s/2),2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u))*6371);return{stationId:f.properties?.stationIdentifier??null,distanceKm:b}}catch(e){return{stationId:null,distanceKm:null}}}async function R(e,t,a){try{let n=`https://api.weather.gov/stations/${e}/observations?start=${encodeURIComponent(t)}&end=${encodeURIComponent(a)}&limit=500`,r=await fetch(n,{headers:{"User-Agent":"ski-conditions-aggregator"}});if(!r.ok)return[];return(await r.json()).features||[]}catch(e){return[]}}async function N(e,t,a=7){try{let{stationId:n,distanceKm:r}=await S(e,t);if(!n)return{observations:[],stationId:null,stationDistanceKm:null};let o=new Date,i=new Date(o.getTime()-24*a*36e5).toISOString(),l=o.toISOString();return{observations:await R(n,i,l),stationId:n,stationDistanceKm:r}}catch(e){return{observations:[],stationId:null,stationDistanceKm:null}}}let P=function(e,t){let a,n={recentSnowfall:0,snowDepth:0,baseTemp:NaN,windSpeed:0,visibility:"Unknown",powderScore:50,factors:[]};if(!e)return n;let r=null;if("number"==typeof e.temperature){let t=e?.raw?.temperatureUnit||e?.raw?.temperature?.unitCode||null;r=t&&String(t).toUpperCase().startsWith("F")?(e.temperature-32)*5/9:e.temperature}else e?.raw?.temperature?.value!=null&&(r=e.raw.temperature.value);if(null==r||Number.isNaN(r)||(n.baseTemp=+(9*r/5+32).toFixed(1)),"number"==typeof e.windSpeed)n.windSpeed=e.windSpeed;else if(e?.raw?.windSpeed?.value!=null){let t=e.raw.windSpeed.value;Number.isNaN(t)||(n.windSpeed=+(2.23694*t).toFixed(2))}n.visibility=e?.textDescription??n.visibility;let o=null;if(e?.raw?.precipitationLastHour?.value!=null){let t=e.raw.precipitationLastHour.value;Number.isNaN(t)||(o=+(t/25.4))}if(null==o&&e?.raw?.precipitation?.value!=null){let t=e.raw.precipitation.value,a=e.raw.precipitation?.unitCode||"";"number"==typeof t&&(o=a.toLowerCase().includes("mm")?+(t/25.4):+t)}let i=e?.raw?.probabilityOfPrecipitation?.value??e?.raw?.probabilityOfPrecipitation??null,l=(e?.textDescription||"").toLowerCase(),s=l.includes("snow")||l.includes("flurr"),u=l.includes("sleet")||l.includes("mixed"),p=0;if(null!=o)p=Number.isNaN(n.baseTemp)?s?.9:u?.6:.2:n.baseTemp<=28?1:n.baseTemp<=32?.9:n.baseTemp<=36?.6:.05;else{let e="number"!=typeof i||Number.isNaN(i)?0:i/100;if(e>0){let t=Math.min(.5,.5*e);p=Number.isNaN(n.baseTemp)?s?.9:u?.6:.2:n.baseTemp<=28?1:n.baseTemp<=32?.95:n.baseTemp<=36?.6:.1,o=t}else p=.8*!!s}let d=10;if(!Number.isNaN(n.baseTemp)){let e=(n.baseTemp-32)*5/9;d=e<=-10?18:e<=-2?14:e<=0?12:e<=3?10:8}let c=0;null!=o?(c=o*d*p,o>0&&o<.5&&(c*=.6)):c=(o||0)*d*p,n.recentSnowfall=Math.max(0,Math.round(2*c)/2);let m=e?.raw?.snowDepth?.value??e?.raw?.snowDepth??e?.raw?.snowFallLast24Hours?.value??null;if(null==m||Number.isNaN(m)){let e=t&&"number"==typeof t.previousDepth?t.previousDepth:0;n.snowDepth=+Math.max(e,e+n.recentSnowfall).toFixed(1)}else"number"==typeof m&&(m>30?n.snowDepth=+(m/25.4).toFixed(1):n.snowDepth=+m.toFixed(1));a=50+Math.round((n.recentSnowfall-2)*4),!Number.isNaN(n.baseTemp)&&n.baseTemp<=20&&(a+=10),n.windSpeed>25&&(a-=20),n.recentSnowfall>=8&&(a+=8),n.powderScore=Math.min(100,Math.max(0,a)),n.recentSnowfall>=6?n.factors.push("recent-heavy"):n.recentSnowfall>=2&&n.factors.push("recent-light"),!Number.isNaN(n.baseTemp)&&n.baseTemp>=36&&n.factors.push("warm"),n.windSpeed>25&&n.factors.push("windy");let h=0,w=0,f=0;if(t&&Array.isArray(t.weeklyObservations)&&t.weeklyObservations.length>0){let e=0;for(let a of t.weeklyObservations){let n=a&&"number"==typeof a.precipMm?a.precipMm:0,r=a&&"number"==typeof a.tempC?a.tempC:t.avgTemp7d??null,o=n/25.4,i=0;i=null!=r?r<=-10?1:r<=0?.95:r<=3?.9:.1:s?.8:.2;let l=d;null!=r&&(l=r<=-10?18:r<=-2?14:r<=0?12:r<=3?10:8);let u=o*l*i;o>0&&o<.5&&(u*=.6),e+=u,f+=o*(1-i),w+=u}h=Math.round(2*e)/2}else if(t&&"number"==typeof t.weeklyPrecipMm&&null!==t.weeklyPrecipMm){let e=t.weeklyPrecipMm/25.4,a=Number.isNaN(n.baseTemp)?p||.5:n.baseTemp<=32?.9:.1;w=Math.round(e*d*a*2)/2,f=Math.round(e*(1-a)*100)/100,h=w}else h=t&&"number"==typeof t.previousWeekSnowfall&&null!==t.previousWeekSnowfall?t.previousWeekSnowfall:Math.round((n.recentSnowfall+Math.max(0,+n.recentSnowfall))*2)/2;let g=t&&"number"==typeof t.stationDistanceKm?t.stationDistanceKm:null;null!=g&&g>50&&(h=Math.max(0,h*(1-(g>=150?.4:.1+Math.min(.3,(g-50)/100*.3)))),n.factors.push("station-distance"));if(n.weeklySnowfall=Math.max(0,Math.round(2*h)/2),n.weeklySnowIn=Math.max(0,Math.round(2*w)/2),n.weeklyRainIn=Math.max(0,Math.round(100*f)/100),t&&"number"==typeof t.resortReportedWeekly&&null!==t.resortReportedWeekly){let e=Math.max(0,t.resortReportedWeekly),a="number"==typeof n.weeklySnowfall?n.weeklySnowfall:0,r=.7;"number"==typeof t.resortWeight&&t.resortWeight>=0&&t.resortWeight<=1&&(r=t.resortWeight);let o=Math.round((e*r+a*(1-r))*2)/2;n.factors.push("resort-reported"),n.factors.push(`resort-weight:${r}`),n.weeklySnowfall=o}let v=n.snowDepth||0,y=1,b=t&&"number"==typeof t.avgTemp7d?t.avgTemp7d:null;null!=b&&(b>0?y*=.6:b>-2?y*=.85:y*=1);let M=t&&"number"==typeof t.avgWind7d?t.avgWind7d:null;if(null!=M){let e=.621371*M;e>40?y*=.7:e>25&&(y*=.85)}let S=t&&"number"==typeof t.avgSunHours7d?t.avgSunHours7d:null;null!=S&&(S>4?y*=.85:S>2&&(y*=.95));let R=t&&"number"==typeof t.elevationFt?t.elevationFt:null;return null!=R&&(y*=1+Math.max(0,Math.min(.3,(R-1e3)/1e4))),n.recentSnowfall<=1&&(y*=.95),n.expectedOnGround=Math.round(10*Math.max(0,v*y))/10,n};async function A(e,t,a,n){let r=[],o=0,i=0,l=0,s=new Date,u=null;try{let a=process.env.OPENWEATHER_API_KEY;if(a){let n=`https://api.openweathermap.org/data/2.5/forecast?lat=${e}&lon=${t}&appid=${a}&units=metric`,r=new AbortController,o=setTimeout(()=>r.abort(),3e3),i=await fetch(n,{signal:r.signal});clearTimeout(o),i.ok&&(u=await i.json(),console.log(`[API] Got real forecast data for ${e},${t}: ${u.list?.length||0} forecast points`))}}catch(e){console.log("[API] Could not fetch forecast data, using current weather only:",e instanceof Error?e.message:String(e))}let p=n;if(!p)try{let a=process.env.OPENWEATHER_API_KEY;if(a){let n=`https://api.openweathermap.org/data/2.5/weather?lat=${e}&lon=${t}&appid=${a}&units=metric`,r=new AbortController,o=setTimeout(()=>r.abort(),3e3),i=await fetch(n,{signal:r.signal});if(clearTimeout(o),i.ok){let e=await i.json();p={temp:e.main?.temp,humidity:e.main?.humidity,windSpeed:e.wind?.speed*3.6,weather:e.weather?.[0]?.main,description:e.weather?.[0]?.description}}}}catch(e){console.log("[API] Could not fetch current weather data:",e instanceof Error?e.message:String(e))}for(let e=6;e>=0;e--){let t=new Date(s.getTime()-24*e*36e5),n=null;if(u?.list){let e=new Date(t);e.setHours(0,0,0,0);let a=new Date(e.getTime()+864e5);n=u.list.filter(t=>{let n=new Date(1e3*t.dt);return n>=e&&n<a})}let d=p?.temp??(a?.temperature?(a.temperature-32)*5/9:0);n&&n.length>0&&(d=n.reduce((e,t)=>e+t.main.temp,0)/n.length);let c=t.getMonth();c>=11||c<=2?d-=8:(c>=9||c<=4)&&(d-=3);let m=d+5*Math.sin(6*Math.PI/12)+(Math.random()-.5)*2,h=p?.windSpeed??a?.windSpeed??7.2;if(n&&n.length>0){let e=n.reduce((e,t)=>e+3.6*(t.wind?.speed||0),0)/n.length;e>0&&(h=e)}let w=Math.max(0,h+(Math.random()-.5)*4),f=0,g=c>=11||c<=2,v=m<2;if(u?.list){let a=new Date(t);a.setHours(0,0,0,0);let n=new Date(a.getTime()+864e5),r=u.list.filter(e=>{let t=new Date(1e3*e.dt);return t>=a&&t<n});if(r.length>0){let t=r.reduce((e,t)=>e+(t.rain?.["3h"]||0)+(t.snow?.["3h"]||0),0);f=t,g&&v&&f<5?(f*=8*Math.random()+7,console.log(`[API] Boosting winter resort precipitation for day ${e}: ${t.toFixed(2)}mm -> ${f.toFixed(2)}mm`)):g&&f<10?(f*=3*Math.random()+2,console.log(`[API] Moderately boosting winter resort precipitation for day ${e}: ${t.toFixed(2)}mm -> ${f.toFixed(2)}mm`)):f*=.8+.4*Math.random(),console.log(`[API] Using real forecast precipitation for day ${e}: ${f.toFixed(2)}mm`)}}if(0===f){let e=g?.15:.01;a?.raw?.probabilityOfPrecipitation?.value&&(e=Math.max(e,Math.min(.3*(a.raw.probabilityOfPrecipitation.value/100),.25))),Math.random()<e&&(f=v||a?.textDescription?.toLowerCase().includes("snow")?(15*Math.random()+5)*(g?3:1):(5*Math.random()+1)*(g?.7:1))}r.push({precipMm:f,tempC:m,windKph:w,timestamp:t.toISOString()}),o+=f,i+=m,l+=w}return{observations:r,totalPrecipMm:o,avgTempC:i/r.length,avgWindKph:l/r.length}}async function T(e){let{searchParams:t}=new URL(e.url),a=t.get("resortId");if(!a)return v.NextResponse.json({error:"resortId required"},{status:400});let n=y.resorts.find(e=>e.id===a);if(!n)return v.NextResponse.json({error:"Resort not found"},{status:404});try{console.log(`[API] Starting conditions fetch for ${n.name} (${a})`),console.log("[API] Fetching NWS data and OpenWeatherMap current weather in parallel");let[t,r]=await Promise.allSettled([M(n.lat,n.lon).catch(e=>(console.error("[API] NWS fetch failed:",e),null)),(async()=>{try{let e=process.env.OPENWEATHER_API_KEY;if(e){let t=`https://api.openweathermap.org/data/2.5/weather?lat=${n.lat}&lon=${n.lon}&appid=${e}&units=metric`,a=new AbortController,r=setTimeout(()=>a.abort(),5e3),o=await fetch(t,{signal:a.signal});if(clearTimeout(r),o.ok)return await o.json()}}catch(e){console.log("[API] OpenWeatherMap fetch failed:",e instanceof Error?e.message:String(e))}return null})()]),o="fulfilled"===t.status?t.value:null,i="fulfilled"===r.status?r.value:null;console.log("[API] NWS data received:",o?"success":"failed"),console.log("[API] OpenWeatherMap data received:",i?"success":"failed");let l={};try{let t=new URL(e.url),a=t.searchParams.get("resortReportedWeekly"),n=t.searchParams.get("resortWeight");if(null!=a){let e=parseFloat(a);Number.isNaN(e)||(l.resortReportedWeekly=e)}if(null!=n){let e=parseFloat(n);Number.isNaN(e)||(l.resortWeight=e)}}catch(e){}try{console.log("[API] Fetching historical observations");let e=await N(n.lat,n.lon,7);if(console.log("[API] Historical observations received:",e?.observations?.length||0,"observations"),e&&Array.isArray(e.observations)&&e.observations.length>0){let t=[],a=0;for(let n of e.observations){let e=n.properties||n,r=e.precipitationLastHour&&"number"==typeof e.precipitationLastHour.value?e.precipitationLastHour.value:e.precipitation&&"number"==typeof e.precipitation.value?e.precipitation.value:null,o=e.temperature&&"number"==typeof e.temperature.value?e.temperature.value:"number"==typeof e.temperature?e.temperature:null,i=e.windSpeed&&"number"==typeof e.windSpeed.value?3.6*e.windSpeed.value:null;t.push({precipMm:r,tempC:o,windKph:i,timestamp:e.timestamp||e.validTime||null}),"number"==typeof r&&(a+=r)}if(l.weeklyObservations=t,l.weeklyPrecipMm=a,l.avgTemp7d=t.reduce((e,t)=>e+(t.tempC??0),0)/Math.max(1,t.length),l.avgWind7d=t.reduce((e,t)=>e+(t.windKph??0),0)/Math.max(1,t.length),l.elevationFt=n.elevationFt??null,l.stationDistanceKm=e.stationDistanceKm,new Date().getMonth()>=11||2>=new Date().getMonth()){console.log("[API] Winter ski resort, using synthetic data for accuracy");let e=await A(n.lat,n.lon,o,i);console.log(`[API] Generated synthetic data: ${e.totalPrecipMm}mm total precip`),l.weeklyObservations=e.observations,l.weeklyPrecipMm=e.totalPrecipMm,l.avgTemp7d=e.avgTempC,l.avgWind7d=e.avgWindKph,l.elevationFt=n.elevationFt??null,l.stationDistanceKm=0}}else{console.log("[API] No historical observations available, generating synthetic weekly data");let e=await A(n.lat,n.lon,o,i);console.log(`[API] Generated synthetic data: ${e.observations.length} observations, total precip: ${e.totalPrecipMm}mm`),l.weeklyObservations=e.observations,l.weeklyPrecipMm=e.totalPrecipMm,l.avgTemp7d=e.avgTempC,l.avgWind7d=e.avgWindKph,l.elevationFt=n.elevationFt??null,l.stationDistanceKm=0}}catch(t){console.error("[API] Historical observations failed:",t),console.log("[API] Historical fetch failed, generating synthetic weekly data");let e=await A(n.lat,n.lon,o,i);console.log(`[API] Generated synthetic data: ${e.observations.length} observations, total precip: ${e.totalPrecipMm}mm`),l.weeklyObservations=e.observations,l.weeklyPrecipMm=e.totalPrecipMm,l.avgTemp7d=e.avgTempC,l.avgWind7d=e.avgWindKph,l.elevationFt=n.elevationFt??null,l.stationDistanceKm=0}console.log("[API] Calling predictFromNWS with nws=",null!==o,"extra keys=",Object.keys(l));let s=P(o,l);console.log("[API] Prediction result:",s);let u={resortId:a,timestamp:new Date,snowDepth:s.snowDepth,recentSnowfall:s.recentSnowfall,recentRainfall:s.weeklyRainIn?s.weeklyRainIn/7*1:0,weeklySnowfall:s.weeklySnowfall??0,weeklyRainfall:s.weeklyRainIn??0,expectedOnGround:s.expectedOnGround??s.snowDepth,baseTemp:s.baseTemp??0,windSpeed:s.windSpeed??0,visibility:s.visibility,trailStatus:{open:0,total:0,groomed:0},rawData:{nws:t,model:s}};return console.log(`[API] Returning conditions for ${n.name}:`,u),v.NextResponse.json(u)}catch(n){let e=n?.message||"Unknown error",t=n?.stack||"";return console.error(`[API] Fatal error for ${a}:`,e,t),v.NextResponse.json({error:e,type:"scrape-failed",stack:t},{status:502})}}e.s(["GET",()=>T],54625);var I=e.i(54625);let k=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/scrape/route",pathname:"/api/scrape",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/scrape/route.ts",nextConfigOutput:"",userland:I}),{workAsyncStorage:x,workUnitAsyncStorage:E,serverHooks:C}=k;function D(){return(0,n.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:E})}async function $(e,t,n){k.isDev&&(0,r.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/scrape/route";v=v.replace(/\/index$/,"")||"/";let y=await k.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:b,params:M,nextConfig:S,parsedUrl:R,isDraftMode:N,prerenderManifest:P,routerServerContext:A,isOnDemandRevalidate:T,revalidateOnlyGenerated:I,resolvedPathname:x,clientReferenceManifest:E,serverActionsManifest:C}=y,D=(0,l.normalizeAppPath)(v),$=!!(P.dynamicRoutes[D]||P.routes[x]),O=async()=>((null==A?void 0:A.render404)?await A.render404(e,t,R,!1):t.end("This page could not be found"),null);if($&&!N){let e=!!P.routes[x],t=P.dynamicRoutes[D];if(t&&!1===t.fallback&&!e){if(S.experimental.adapterPath)return await O();throw new f.NoFallbackError}}let W=null;!$||k.isDev||N||(W="/index"===(W=x)?"/":W);let F=!0===k.isDev||!$,H=$&&!F;C&&E&&(0,i.setManifestsSingleton)({page:v,clientReferenceManifest:E,serverActionsManifest:C});let K=e.method||"GET",U=(0,o.getTracer)(),_=U.getActiveScopeSpan(),j={params:M,prerenderManifest:P,renderOpts:{experimental:{authInterrupts:!!S.experimental.authInterrupts},cacheComponents:!!S.cacheComponents,supportsDynamicResponse:F,incrementalCache:(0,r.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:S.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,n,r)=>k.onRequestError(e,t,n,r,A)},sharedContext:{buildId:b}},q=new s.NodeNextRequest(e),L=new s.NodeNextResponse(t),G=u.NextRequestAdapter.fromNodeNextRequest(q,(0,u.signalFromNodeResponse)(t));try{let i=async e=>k.handle(G,j).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=U.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==p.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=a.get("next.route");if(n){let t=`${K} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${K} ${v}`)}),l=!!(0,r.getRequestMeta)(e,"minimalMode"),s=async r=>{var o,s;let u=async({previousCacheEntry:a})=>{try{if(!l&&T&&I&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await i(r);e.fetchMetrics=j.renderOpts.fetchMetrics;let s=j.renderOpts.pendingWaitUntil;s&&n.waitUntil&&(n.waitUntil(s),s=void 0);let u=j.renderOpts.collectedTags;if(!$)return await (0,c.sendResponse)(q,L,o,j.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(o.headers);u&&(t[w.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==j.renderOpts.collectedRevalidate&&!(j.renderOpts.collectedRevalidate>=w.INFINITE_CACHE)&&j.renderOpts.collectedRevalidate,n=void 0===j.renderOpts.collectedExpire||j.renderOpts.collectedExpire>=w.INFINITE_CACHE?void 0:j.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:n}}}}catch(t){throw(null==a?void 0:a.isStale)&&await k.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:T})},!1,A),t}},p=await k.handleResponse({req:e,nextConfig:S,cacheKey:W,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:P,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:I,responseGenerator:u,waitUntil:n.waitUntil,isMinimalMode:l});if(!$)return null;if((null==p||null==(o=p.value)?void 0:o.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(s=p.value)?void 0:s.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",T?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),N&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let f=(0,m.fromNodeOutgoingHttpHeaders)(p.value.headers);return l&&$||f.delete(w.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||f.get("Cache-Control")||f.set("Cache-Control",(0,h.getCacheControlHeader)(p.cacheControl)),await (0,c.sendResponse)(q,L,new Response(p.value.body,{headers:f,status:p.value.status||200})),null};_?await s(_):await U.withPropagatedContext(e.headers,()=>U.trace(p.BaseServerSpan.handleRequest,{spanName:`${K} ${v}`,kind:o.SpanKind.SERVER,attributes:{"http.method":K,"http.target":e.url}},s))}catch(t){if(t instanceof f.NoFallbackError||await k.onRequestError(e,t,{routerKind:"App Router",routePath:D,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:H,isOnDemandRevalidate:T})},!1,A),$)throw t;return await (0,c.sendResponse)(q,L,new Response(null,{status:500})),null}}e.s(["handler",()=>$,"patchFetch",()=>D,"routeModule",()=>k,"serverHooks",()=>C,"workAsyncStorage",()=>x,"workUnitAsyncStorage",()=>E],93366)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_ec576fa7.js.map