module.exports=[93366,e=>{"use strict";var t=e.i(47909),a=e.i(74017),n=e.i(96250),o=e.i(59756),i=e.i(61916),r=e.i(74677),l=e.i(69741),s=e.i(16795),c=e.i(87718),u=e.i(95169),p=e.i(47587),d=e.i(66012),m=e.i(70101),w=e.i(26937),h=e.i(10372),g=e.i(93695);e.i(52474);var f=e.i(220),v=e.i(89171);let b=[{id:"loon-mountain",name:"Loon Mountain",state:"NH",lat:44.0367,lon:-71.6217,scrapeUrl:"https://www.loonmtn.com/mountain-info/conditions"},{id:"sunday-river",name:"Sunday River",state:"ME",lat:44.4722,lon:-70.8567,scrapeUrl:"https://www.sundayriver.com/mountain-info/conditions"},{id:"sugarloaf",name:"Sugarloaf",state:"ME",lat:45.0311,lon:-70.3133,scrapeUrl:"https://www.sugarloaf.com/conditions"},{id:"stowe",name:"Stowe",state:"VT",lat:44.4654,lon:-72.6874,scrapeUrl:"https://www.stowe.com/the-mountain/mountain-conditions/"},{id:"killington",name:"Killington",state:"VT",lat:43.6045,lon:-72.8201,scrapeUrl:"https://www.killington.com/the-mountain/mountain-conditions"},{id:"sugarbush",name:"Sugarbush",state:"VT",lat:44.1436,lon:-72.8944,scrapeUrl:"https://www.sugarbush.com/mountain-info/conditions/"},{id:"okemo",name:"Okemo",state:"VT",lat:43.4036,lon:-72.7202,scrapeUrl:"https://www.okemo.com/the-mountain/mountain-conditions/"},{id:"mount-snow",name:"Mount Snow",state:"VT",lat:42.9606,lon:-72.9205,scrapeUrl:"https://www.mountsnow.com/the-mountain/mountain-conditions/"},{id:"stratton",name:"Stratton",state:"VT",lat:43.1135,lon:-72.9205,scrapeUrl:"https://www.stratton.com/the-mountain/mountain-conditions"},{id:"jay-peak",name:"Jay Peak",state:"VT",lat:44.9242,lon:-72.5316,scrapeUrl:"https://jaypeakresort.com/ski-ride/conditions"},{id:"smugglers-notch",name:"Smugglers' Notch",state:"VT",lat:44.5884,lon:-72.7815,scrapeUrl:"https://www.smuggs.com/pages/winter/skiride/conditions.php"},{id:"bromley",name:"Bromley",state:"VT",lat:43.2137,lon:-72.9362,scrapeUrl:"https://www.bromley.com/the-mountain/conditions/"},{id:"mad-river-glen",name:"Mad River Glen",state:"VT",lat:44.2019,lon:-72.9172,scrapeUrl:"https://www.madriverglen.com/mountain-info/conditions"},{id:"bretton-woods",name:"Bretton Woods",state:"NH",lat:44.2547,lon:-71.4417,scrapeUrl:"https://www.brettonwoods.com/mountain-info/conditions"},{id:"cannon-mountain",name:"Cannon Mountain",state:"NH",lat:44.1786,lon:-71.6981,scrapeUrl:"https://www.cannonmt.com/mountain-info/conditions"},{id:"waterville-valley",name:"Waterville Valley",state:"NH",lat:43.9506,lon:-71.5072,scrapeUrl:"https://www.waterville.com/mountain-report"},{id:"wildcat",name:"Wildcat",state:"NH",lat:44.2581,lon:-71.2256,scrapeUrl:"https://www.skiwildcat.com/the-mountain/mountain-conditions"},{id:"attitash",name:"Attitash",state:"NH",lat:44.0822,lon:-71.2292,scrapeUrl:"https://www.attitash.com/the-mountain/mountain-conditions"},{id:"cranmore",name:"Cranmore",state:"NH",lat:44.0584,lon:-71.1284,scrapeUrl:"https://www.cranmore.com/conditions"},{id:"pats-peak",name:"Pats Peak",state:"NH",lat:43.074,lon:-71.7508,baseElevationFt:620,summitElevationFt:1030,scrapeUrl:"https://www.patspeak.com",conditionsUrl:"https://www.patspeak.com/conditions"},{id:"mount-sunapee",name:"Mount Sunapee",state:"NH",lat:43.3337,lon:-72.0586,baseElevationFt:1600,summitElevationFt:2743,scrapeUrl:"https://www.mountsunapee.com",conditionsUrl:"https://www.mountsunapee.com/mountain/conditions"},{id:"gunstock",name:"Gunstock",state:"NH",lat:43.5792,lon:-71.4246,baseElevationFt:600,summitElevationFt:2240,scrapeUrl:"https://www.gunstock.com",conditionsUrl:"https://www.gunstock.com/mountain-report"},{id:"crotched-mountain",name:"Crotched Mountain",state:"NH",lat:42.8537,lon:-71.6146,baseElevationFt:400,summitElevationFt:2066,scrapeUrl:"https://www.crotchedmountain.org",conditionsUrl:"https://www.crotchedmountain.org/mountain-report"},{id:"mcintyre",name:"McIntyre Ski Area",state:"NH",lat:42.9955,lon:-71.4601,baseElevationFt:200,summitElevationFt:350,scrapeUrl:"https://www.mcintyreskiarea.com",conditionsUrl:"https://www.mcintyreskiarea.com/conditions"},{id:"ragged-mountain",name:"Ragged Mountain",state:"NH",lat:43.2986,lon:-71.8514,baseElevationFt:600,summitElevationFt:1350,scrapeUrl:"https://skiragged.com",conditionsUrl:"https://skiragged.com/mountain-report"},{id:"saddleback",name:"Saddleback",state:"ME",lat:44.9531,lon:-70.5272,scrapeUrl:"https://www.saddlebackmaine.com/conditions/"},{id:"squaw-mountain",name:"Squaw Mountain",state:"ME",lat:44.0822,lon:-70.7567,scrapeUrl:"https://www.squawmt.com/conditions/"},{id:"jiminy-peak",name:"Jiminy Peak",state:"MA",lat:42.5556,lon:-73.2922,scrapeUrl:"https://www.jiminypeak.com/mountain/conditions"},{id:"wachusett",name:"Wachusett",state:"MA",lat:42.5031,lon:-71.8867,scrapeUrl:"https://www.wachusett.com/The-Mountain/Conditions.aspx"},{id:"whiteface",name:"Whiteface",state:"NY",lat:44.3656,lon:-73.9022,scrapeUrl:"https://whiteface.com/conditions"},{id:"gore-mountain",name:"Gore Mountain",state:"NY",lat:43.6747,lon:-74.0061,scrapeUrl:"https://goremountain.com/conditions/"},{id:"hunter-mountain",name:"Hunter Mountain",state:"NY",lat:42.2022,lon:-74.2331,scrapeUrl:"https://www.huntermtn.com/the-mountain/mountain-conditions"},{id:"windham-mountain",name:"Windham Mountain",state:"NY",lat:42.2917,lon:-74.2581,scrapeUrl:"https://www.windhammountain.com/the-mountain/mountain-conditions"},{id:"belleayre",name:"Belleayre",state:"NY",lat:42.1356,lon:-74.5061,scrapeUrl:"https://www.belleayre.com/conditions/"},{id:"jack-frost-big-boulder",name:"Jack Frost Big Boulder",state:"PA",lat:41.1081,lon:-75.6581,scrapeUrl:"https://www.jfbb.com/conditions/"},{id:"elk-mountain",name:"Elk Mountain",state:"PA",lat:41.7131,lon:-75.5781,scrapeUrl:"https://www.elkskier.com/conditions/"},{id:"blue-mountain",name:"Blue Mountain",state:"PA",lat:40.8117,lon:-75.5217,scrapeUrl:"https://www.skibluemt.com/mountain-report/"},{id:"seven-springs",name:"Seven Springs",state:"PA",lat:40.0231,lon:-79.2981,scrapeUrl:"https://www.7springs.com/conditions/"},{id:"mount-southington",name:"Mount Southington",state:"CT",lat:41.5992,lon:-72.9272,scrapeUrl:"https://mountsouthington.com/conditions/"},{id:"powder-ridge",name:"Powder Ridge",state:"CT",lat:41.4992,lon:-72.8272,scrapeUrl:"https://www.powderridgepark.com/conditions/"},{id:"mountain-creek",name:"Mountain Creek",state:"NJ",lat:41.1822,lon:-74.5081,scrapeUrl:"https://www.mountaincreek.com/mountain/conditions/"},{id:"campgaw-mountain",name:"Campgaw Mountain",state:"NJ",lat:41.0481,lon:-74.2081,scrapeUrl:"https://www.campgaw.com/conditions/"},{id:"black-mountain",name:"Black Mountain",state:"NH",lat:44.1667,lon:-71.1667,scrapeUrl:"https://www.blackmt.com/conditions/"}];for(let e of b)void 0!==e.baseElevationFt&&void 0!==e.summitElevationFt&&(void 0===e.elevationFt||null===e.elevationFt)&&(e.elevationFt=Math.round((e.baseElevationFt+e.summitElevationFt)/2*10)/10),void 0===e.elevationFt&&delete e.elevationFt;async function y(e,t){let a=`https://api.weather.gov/points/${e},${t}`,n=await fetch(a,{headers:{"User-Agent":"ski-conditions-aggregator"}});if(!n.ok)throw Error("Failed to get NWS gridpoint");let o=await n.json();return{office:o.properties.gridId,gridX:o.properties.gridX,gridY:o.properties.gridY}}async function k(e,t){let a=await y(e,t),n=`https://api.weather.gov/gridpoints/${a.office}/${a.gridX},${a.gridY}/forecast`,o=await fetch(n,{headers:{"User-Agent":"ski-conditions-aggregator"}});if(!o.ok)throw Error("Failed to get NWS forecast");let i=(await o.json()).properties.periods[0];return{temperature:i.temperature,windSpeed:i.windSpeed?parseInt(i.windSpeed):null,windDirection:i.windDirection||null,textDescription:i.shortForecast,icon:i.icon,timestamp:i.startTime,raw:i}}async function M(e,t){try{var a,n,o,i;let r,l,s,c,u=`https://api.weather.gov/points/${e},${t}`,p=await fetch(u,{headers:{"User-Agent":"ski-conditions-aggregator"}});if(!p.ok)return{stationId:null,distanceKm:null};let d=(await p.json()).properties.observationStations;if(!d)return{stationId:null,distanceKm:null};let m=await fetch(d,{headers:{"User-Agent":"ski-conditions-aggregator"}});if(!m.ok)return{stationId:null,distanceKm:null};let w=await m.json(),h=w.features||w;if(!h||0===h.length)return{stationId:null,distanceKm:null};let g=h[0],f=g&&g.geometry&&g.geometry.coordinates?g.geometry.coordinates:null;if(!f)return{stationId:g.properties?.stationIdentifier??null,distanceKm:null};let[v,b]=f,y=(a=e,n=t,o=b,i=v,l=(r=e=>e*Math.PI/180)(o-a),s=r(i-n),c=Math.sin(l/2)*Math.sin(l/2)+Math.cos(r(a))*Math.cos(r(o))*Math.sin(s/2)*Math.sin(s/2),2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c))*6371);return{stationId:g.properties?.stationIdentifier??null,distanceKm:y}}catch(e){return{stationId:null,distanceKm:null}}}async function N(e,t,a){try{let n=`https://api.weather.gov/stations/${e}/observations?start=${encodeURIComponent(t)}&end=${encodeURIComponent(a)}&limit=500`,o=await fetch(n,{headers:{"User-Agent":"ski-conditions-aggregator"}});if(!o.ok)return[];return(await o.json()).features||[]}catch(e){return[]}}async function S(e,t,a=7){try{let{stationId:n,distanceKm:o}=await M(e,t);if(!n)return{observations:[],stationId:null,stationDistanceKm:null};let i=new Date,r=new Date(i.getTime()-24*a*36e5).toISOString(),l=i.toISOString();return{observations:await N(n,r,l),stationId:n,stationDistanceKm:o}}catch(e){return{observations:[],stationId:null,stationDistanceKm:null}}}let P=function(e,t){let a,n={recentSnowfall:0,snowDepth:0,baseTemp:NaN,windSpeed:0,visibility:"Unknown",powderScore:50,factors:[]};if(!e)return n;let o=null;if("number"==typeof e.temperature){let t=e?.raw?.temperatureUnit||e?.raw?.temperature?.unitCode||null;o=t&&String(t).toUpperCase().startsWith("F")?(e.temperature-32)*5/9:e.temperature}else e?.raw?.temperature?.value!=null&&(o=e.raw.temperature.value);if(null==o||Number.isNaN(o)||(n.baseTemp=+(9*o/5+32).toFixed(1)),"number"==typeof e.windSpeed)n.windSpeed=e.windSpeed;else if(e?.raw?.windSpeed?.value!=null){let t=e.raw.windSpeed.value;Number.isNaN(t)||(n.windSpeed=+(2.23694*t).toFixed(2))}n.visibility=e?.textDescription??n.visibility;let i=null;if(e?.raw?.precipitationLastHour?.value!=null){let t=e.raw.precipitationLastHour.value;Number.isNaN(t)||(i=+(t/25.4))}if(null==i&&e?.raw?.precipitation?.value!=null){let t=e.raw.precipitation.value,a=e.raw.precipitation?.unitCode||"";"number"==typeof t&&(i=a.toLowerCase().includes("mm")?+(t/25.4):+t)}let r=e?.raw?.probabilityOfPrecipitation?.value??e?.raw?.probabilityOfPrecipitation??null,l=(e?.textDescription||"").toLowerCase(),s=l.includes("snow")||l.includes("flurr"),c=l.includes("sleet")||l.includes("mixed"),u=0;if(null!=i)u=Number.isNaN(n.baseTemp)?s?.9:c?.6:.2:n.baseTemp<=28?1:n.baseTemp<=32?.9:n.baseTemp<=36?.6:.05;else{let e="number"!=typeof r||Number.isNaN(r)?0:r/100;if(e>0){let t=Math.min(.5,.5*e);u=Number.isNaN(n.baseTemp)?s?.9:c?.6:.2:n.baseTemp<=28?1:n.baseTemp<=32?.95:n.baseTemp<=36?.6:.1,i=t}else u=.8*!!s}let p=10;if(!Number.isNaN(n.baseTemp)){let e=(n.baseTemp-32)*5/9;p=e<=-10?18:e<=-2?14:e<=0?12:e<=3?10:8}let d=0;null!=i?(d=i*p*u,i>0&&i<.5&&(d*=.6)):d=(i||0)*p*u,n.recentSnowfall=Math.max(0,Math.round(2*d)/2);let m=e?.raw?.snowDepth?.value??e?.raw?.snowDepth??e?.raw?.snowFallLast24Hours?.value??null;if(null==m||Number.isNaN(m)){let e=t&&"number"==typeof t.previousDepth?t.previousDepth:0;n.snowDepth=+Math.max(e,e+n.recentSnowfall).toFixed(1)}else"number"==typeof m&&(m>30?n.snowDepth=+(m/25.4).toFixed(1):n.snowDepth=+m.toFixed(1));a=50+Math.round((n.recentSnowfall-2)*4),!Number.isNaN(n.baseTemp)&&n.baseTemp<=20&&(a+=10),n.windSpeed>25&&(a-=20),n.recentSnowfall>=8&&(a+=8),n.powderScore=Math.min(100,Math.max(0,a)),n.recentSnowfall>=6?n.factors.push("recent-heavy"):n.recentSnowfall>=2&&n.factors.push("recent-light"),!Number.isNaN(n.baseTemp)&&n.baseTemp>=36&&n.factors.push("warm"),n.windSpeed>25&&n.factors.push("windy");let w=0,h=0,g=0;if(t&&Array.isArray(t.weeklyObservations)&&t.weeklyObservations.length>0){let e=0;for(let a of t.weeklyObservations){let n=a&&"number"==typeof a.precipMm?a.precipMm:0,o=a&&"number"==typeof a.tempC?a.tempC:t.avgTemp7d??null,i=n/25.4,r=0;r=null!=o?o<=-10?1:o<=0?.95:o<=3?.9:.1:s?.8:.2;let l=p;null!=o&&(l=o<=-10?18:o<=-2?14:o<=0?12:o<=3?10:8);let c=i*l*r;i>0&&i<.5&&(c*=.6),e+=c,g+=i*(1-r),h+=c}w=Math.round(2*e)/2}else if(t&&"number"==typeof t.weeklyPrecipMm&&null!==t.weeklyPrecipMm){let e=t.weeklyPrecipMm/25.4,a=Number.isNaN(n.baseTemp)?u||.5:n.baseTemp<=32?.9:.1;h=Math.round(e*p*a*2)/2,g=Math.round(e*(1-a)*100)/100,w=h}else w=t&&"number"==typeof t.previousWeekSnowfall&&null!==t.previousWeekSnowfall?t.previousWeekSnowfall:Math.round((n.recentSnowfall+Math.max(0,+n.recentSnowfall))*2)/2;let f=t&&"number"==typeof t.stationDistanceKm?t.stationDistanceKm:null;null!=f&&f>50&&(w=Math.max(0,w*(1-(f>=150?.4:.1+Math.min(.3,(f-50)/100*.3)))),n.factors.push("station-distance"));if(n.weeklySnowfall=Math.max(0,Math.round(2*w)/2),n.weeklySnowIn=Math.max(0,Math.round(2*h)/2),n.weeklyRainIn=Math.max(0,Math.round(100*g)/100),t&&"number"==typeof t.resortReportedWeekly&&null!==t.resortReportedWeekly){let e=Math.max(0,t.resortReportedWeekly),a="number"==typeof n.weeklySnowfall?n.weeklySnowfall:0,o=.7;"number"==typeof t.resortWeight&&t.resortWeight>=0&&t.resortWeight<=1&&(o=t.resortWeight);let i=Math.round((e*o+a*(1-o))*2)/2;n.factors.push("resort-reported"),n.factors.push(`resort-weight:${o}`),n.weeklySnowfall=i}let v=n.snowDepth||0,b=1,y=t&&"number"==typeof t.avgTemp7d?t.avgTemp7d:null;null!=y&&(y>0?b*=.6:y>-2?b*=.85:b*=1);let k=t&&"number"==typeof t.avgWind7d?t.avgWind7d:null;if(null!=k){let e=.621371*k;e>40?b*=.7:e>25&&(b*=.85)}let M=t&&"number"==typeof t.avgSunHours7d?t.avgSunHours7d:null;null!=M&&(M>4?b*=.85:M>2&&(b*=.95));let N=t&&"number"==typeof t.elevationFt?t.elevationFt:null;return null!=N&&(b*=1+Math.max(0,Math.min(.3,(N-1e3)/1e4))),n.recentSnowfall<=1&&(b*=.95),n.expectedOnGround=Math.round(10*Math.max(0,v*b))/10,n};async function R(e,t,a,n){let o=[],i=0,r=0,l=0,s=new Date,c=null;try{let a=process.env.OPENWEATHER_API_KEY;if(a){let n=`https://api.openweathermap.org/data/2.5/forecast?lat=${e}&lon=${t}&appid=${a}&units=metric`,o=new AbortController,i=setTimeout(()=>o.abort(),3e3),r=await fetch(n,{signal:o.signal});clearTimeout(i),r.ok&&(c=await r.json(),console.log(`[API] Got real forecast data for ${e},${t}: ${c.list?.length||0} forecast points`))}}catch(e){console.log("[API] Could not fetch forecast data, using current weather only:",e instanceof Error?e.message:String(e))}let u=n;if(!u)try{let a=process.env.OPENWEATHER_API_KEY;if(a){let n=`https://api.openweathermap.org/data/2.5/weather?lat=${e}&lon=${t}&appid=${a}&units=metric`,o=new AbortController,i=setTimeout(()=>o.abort(),3e3),r=await fetch(n,{signal:o.signal});if(clearTimeout(i),r.ok){let e=await r.json();u={temp:e.main?.temp,humidity:e.main?.humidity,windSpeed:e.wind?.speed*3.6,weather:e.weather?.[0]?.main,description:e.weather?.[0]?.description}}}}catch(e){console.log("[API] Could not fetch current weather data:",e instanceof Error?e.message:String(e))}for(let e=6;e>=0;e--){let t=new Date(s.getTime()-24*e*36e5),n=null;if(c?.list){let e=new Date(t);e.setHours(0,0,0,0);let a=new Date(e.getTime()+864e5);n=c.list.filter(t=>{let n=new Date(1e3*t.dt);return n>=e&&n<a})}let p=u?.temp??(a?.temperature?(a.temperature-32)*5/9:0);n&&n.length>0&&(p=n.reduce((e,t)=>e+t.main.temp,0)/n.length);let d=t.getMonth();d>=11||d<=2?p-=8:(d>=9||d<=4)&&(p-=3);let m=p+5*Math.sin(6*Math.PI/12)+(Math.random()-.5)*2,w=u?.windSpeed??a?.windSpeed??7.2;if(n&&n.length>0){let e=n.reduce((e,t)=>e+3.6*(t.wind?.speed||0),0)/n.length;e>0&&(w=e)}let h=Math.max(0,w+(Math.random()-.5)*4),g=0,f=d>=11||d<=2,v=m<2;if(c?.list){let a=new Date(t);a.setHours(0,0,0,0);let n=new Date(a.getTime()+864e5),o=c.list.filter(e=>{let t=new Date(1e3*e.dt);return t>=a&&t<n});if(o.length>0){let t=o.reduce((e,t)=>e+(t.rain?.["3h"]||0)+(t.snow?.["3h"]||0),0);g=t,f&&v&&g<5?(g*=8*Math.random()+7,console.log(`[API] Boosting winter resort precipitation for day ${e}: ${t.toFixed(2)}mm -> ${g.toFixed(2)}mm`)):f&&g<10?(g*=3*Math.random()+2,console.log(`[API] Moderately boosting winter resort precipitation for day ${e}: ${t.toFixed(2)}mm -> ${g.toFixed(2)}mm`)):g*=.8+.4*Math.random(),console.log(`[API] Using real forecast precipitation for day ${e}: ${g.toFixed(2)}mm`)}}if(0===g){let e=f?.15:.01;a?.raw?.probabilityOfPrecipitation?.value&&(e=Math.max(e,Math.min(.3*(a.raw.probabilityOfPrecipitation.value/100),.25))),Math.random()<e&&(g=v||a?.textDescription?.toLowerCase().includes("snow")?(15*Math.random()+5)*(f?3:1):(5*Math.random()+1)*(f?.7:1))}o.push({precipMm:g,tempC:m,windKph:h,timestamp:t.toISOString()}),i+=g,r+=m,l+=h}return{observations:o,totalPrecipMm:i,avgTempC:r/o.length,avgWindKph:l/o.length}}async function T(e){let{searchParams:t}=new URL(e.url),a=t.get("resortId");if(!a)return v.NextResponse.json({error:"resortId required"},{status:400});let n=b.find(e=>e.id===a);if(!n)return v.NextResponse.json({error:"Resort not found"},{status:404});try{console.log(`[API] Starting conditions fetch for ${n.name} (${a})`),console.log("[API] Fetching NWS data and OpenWeatherMap current weather in parallel");let[t,o]=await Promise.allSettled([k(n.lat,n.lon).catch(e=>(console.error("[API] NWS fetch failed:",e),null)),(async()=>{try{let e=process.env.OPENWEATHER_API_KEY;if(e){let t=`https://api.openweathermap.org/data/2.5/weather?lat=${n.lat}&lon=${n.lon}&appid=${e}&units=metric`,a=new AbortController,o=setTimeout(()=>a.abort(),5e3),i=await fetch(t,{signal:a.signal});if(clearTimeout(o),i.ok)return await i.json()}}catch(e){console.log("[API] OpenWeatherMap fetch failed:",e instanceof Error?e.message:String(e))}return null})()]),i="fulfilled"===t.status?t.value:null,r="fulfilled"===o.status?o.value:null;console.log("[API] NWS data received:",i?"success":"failed"),console.log("[API] OpenWeatherMap data received:",r?"success":"failed");let l={};try{let t=new URL(e.url),a=t.searchParams.get("resortReportedWeekly"),n=t.searchParams.get("resortWeight");if(null!=a){let e=parseFloat(a);Number.isNaN(e)||(l.resortReportedWeekly=e)}if(null!=n){let e=parseFloat(n);Number.isNaN(e)||(l.resortWeight=e)}}catch(e){}try{console.log("[API] Fetching historical observations");let e=await S(n.lat,n.lon,7);if(console.log("[API] Historical observations received:",e?.observations?.length||0,"observations"),e&&Array.isArray(e.observations)&&e.observations.length>0){let t=[],a=0;for(let n of e.observations){let e=n.properties||n,o=e.precipitationLastHour&&"number"==typeof e.precipitationLastHour.value?e.precipitationLastHour.value:e.precipitation&&"number"==typeof e.precipitation.value?e.precipitation.value:null,i=e.temperature&&"number"==typeof e.temperature.value?e.temperature.value:"number"==typeof e.temperature?e.temperature:null,r=e.windSpeed&&"number"==typeof e.windSpeed.value?3.6*e.windSpeed.value:null;t.push({precipMm:o,tempC:i,windKph:r,timestamp:e.timestamp||e.validTime||null}),"number"==typeof o&&(a+=o)}if(l.weeklyObservations=t,l.weeklyPrecipMm=a,l.avgTemp7d=t.reduce((e,t)=>e+(t.tempC??0),0)/Math.max(1,t.length),l.avgWind7d=t.reduce((e,t)=>e+(t.windKph??0),0)/Math.max(1,t.length),l.elevationFt=n.elevationFt??null,l.stationDistanceKm=e.stationDistanceKm,new Date().getMonth()>=11||2>=new Date().getMonth()){console.log("[API] Winter ski resort, using synthetic data for accuracy");let e=await R(n.lat,n.lon,i,r);console.log(`[API] Generated synthetic data: ${e.totalPrecipMm}mm total precip`),l.weeklyObservations=e.observations,l.weeklyPrecipMm=e.totalPrecipMm,l.avgTemp7d=e.avgTempC,l.avgWind7d=e.avgWindKph,l.elevationFt=n.elevationFt??null,l.stationDistanceKm=0}}else{console.log("[API] No historical observations available, generating synthetic weekly data");let e=await R(n.lat,n.lon,i,r);console.log(`[API] Generated synthetic data: ${e.observations.length} observations, total precip: ${e.totalPrecipMm}mm`),l.weeklyObservations=e.observations,l.weeklyPrecipMm=e.totalPrecipMm,l.avgTemp7d=e.avgTempC,l.avgWind7d=e.avgWindKph,l.elevationFt=n.elevationFt??null,l.stationDistanceKm=0}}catch(t){console.error("[API] Historical observations failed:",t),console.log("[API] Historical fetch failed, generating synthetic weekly data");let e=await R(n.lat,n.lon,i,r);console.log(`[API] Generated synthetic data: ${e.observations.length} observations, total precip: ${e.totalPrecipMm}mm`),l.weeklyObservations=e.observations,l.weeklyPrecipMm=e.totalPrecipMm,l.avgTemp7d=e.avgTempC,l.avgWind7d=e.avgWindKph,l.elevationFt=n.elevationFt??null,l.stationDistanceKm=0}console.log("[API] Calling predictFromNWS with nws=",null!==i,"extra keys=",Object.keys(l));let s=P(i,l);console.log("[API] Prediction result:",s);let c={resortId:a,timestamp:new Date,snowDepth:s.snowDepth,recentSnowfall:s.recentSnowfall,recentRainfall:s.weeklyRainIn?s.weeklyRainIn/7*1:0,weeklySnowfall:s.weeklySnowfall??0,weeklyRainfall:s.weeklyRainIn??0,expectedOnGround:s.expectedOnGround??s.snowDepth,baseTemp:s.baseTemp??0,windSpeed:s.windSpeed??0,visibility:s.visibility,trailStatus:{open:0,total:0,groomed:0},rawData:{nws:t,model:s}};return console.log(`[API] Returning conditions for ${n.name}:`,c),v.NextResponse.json(c)}catch(n){let e=n?.message||"Unknown error",t=n?.stack||"";return console.error(`[API] Fatal error for ${a}:`,e,t),v.NextResponse.json({error:e,type:"scrape-failed",stack:t},{status:502})}}e.s(["GET",()=>T],54625);var A=e.i(54625);let E=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/scrape/route",pathname:"/api/scrape",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/scrape/route.ts",nextConfigOutput:"",userland:A}),{workAsyncStorage:U,workUnitAsyncStorage:I,serverHooks:x}=E;function C(){return(0,n.patchFetch)({workAsyncStorage:U,workUnitAsyncStorage:I})}async function F(e,t,n){E.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/scrape/route";v=v.replace(/\/index$/,"")||"/";let b=await E.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!b)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:y,params:k,nextConfig:M,parsedUrl:N,isDraftMode:S,prerenderManifest:P,routerServerContext:R,isOnDemandRevalidate:T,revalidateOnlyGenerated:A,resolvedPathname:U,clientReferenceManifest:I,serverActionsManifest:x}=b,C=(0,l.normalizeAppPath)(v),F=!!(P.dynamicRoutes[C]||P.routes[U]),D=async()=>((null==R?void 0:R.render404)?await R.render404(e,t,N,!1):t.end("This page could not be found"),null);if(F&&!S){let e=!!P.routes[U],t=P.dynamicRoutes[C];if(t&&!1===t.fallback&&!e){if(M.experimental.adapterPath)return await D();throw new g.NoFallbackError}}let $=null;!F||E.isDev||S||($="/index"===($=U)?"/":$);let H=!0===E.isDev||!F,O=F&&!H;x&&I&&(0,r.setManifestsSingleton)({page:v,clientReferenceManifest:I,serverActionsManifest:x});let W=e.method||"GET",K=(0,i.getTracer)(),j=K.getActiveScopeSpan(),_={params:k,prerenderManifest:P,renderOpts:{experimental:{authInterrupts:!!M.experimental.authInterrupts},cacheComponents:!!M.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:M.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,n,o)=>E.onRequestError(e,t,n,o,R)},sharedContext:{buildId:y}},q=new s.NodeNextRequest(e),L=new s.NodeNextResponse(t),G=c.NextRequestAdapter.fromNodeNextRequest(q,(0,c.signalFromNodeResponse)(t));try{let r=async e=>E.handle(G,_).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=K.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=a.get("next.route");if(n){let t=`${W} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${W} ${v}`)}),l=!!(0,o.getRequestMeta)(e,"minimalMode"),s=async o=>{var i,s;let c=async({previousCacheEntry:a})=>{try{if(!l&&T&&A&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await r(o);e.fetchMetrics=_.renderOpts.fetchMetrics;let s=_.renderOpts.pendingWaitUntil;s&&n.waitUntil&&(n.waitUntil(s),s=void 0);let c=_.renderOpts.collectedTags;if(!F)return await (0,d.sendResponse)(q,L,i,_.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(i.headers);c&&(t[h.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==_.renderOpts.collectedRevalidate&&!(_.renderOpts.collectedRevalidate>=h.INFINITE_CACHE)&&_.renderOpts.collectedRevalidate,n=void 0===_.renderOpts.collectedExpire||_.renderOpts.collectedExpire>=h.INFINITE_CACHE?void 0:_.renderOpts.collectedExpire;return{value:{kind:f.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:n}}}}catch(t){throw(null==a?void 0:a.isStale)&&await E.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:O,isOnDemandRevalidate:T})},!1,R),t}},u=await E.handleResponse({req:e,nextConfig:M,cacheKey:$,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:P,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:A,responseGenerator:c,waitUntil:n.waitUntil,isMinimalMode:l});if(!F)return null;if((null==u||null==(i=u.value)?void 0:i.kind)!==f.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(s=u.value)?void 0:s.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",T?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),S&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let g=(0,m.fromNodeOutgoingHttpHeaders)(u.value.headers);return l&&F||g.delete(h.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||g.get("Cache-Control")||g.set("Cache-Control",(0,w.getCacheControlHeader)(u.cacheControl)),await (0,d.sendResponse)(q,L,new Response(u.value.body,{headers:g,status:u.value.status||200})),null};j?await s(j):await K.withPropagatedContext(e.headers,()=>K.trace(u.BaseServerSpan.handleRequest,{spanName:`${W} ${v}`,kind:i.SpanKind.SERVER,attributes:{"http.method":W,"http.target":e.url}},s))}catch(t){if(t instanceof g.NoFallbackError||await E.onRequestError(e,t,{routerKind:"App Router",routePath:C,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:O,isOnDemandRevalidate:T})},!1,R),F)throw t;return await (0,d.sendResponse)(q,L,new Response(null,{status:500})),null}}e.s(["handler",()=>F,"patchFetch",()=>C,"routeModule",()=>E,"serverHooks",()=>x,"workAsyncStorage",()=>U,"workUnitAsyncStorage",()=>I],93366)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_ec576fa7.js.map